{"version":3,"sources":["store/modules/blocklog/index.ts","components/bklog/Blocklog.tsx","store/modules/auth/index.ts","store/modules/auth/utils/index.ts","pages/Home.tsx","components/editor/index.tsx","store/modules/bklog/utils/converter.ts","store/modules/bklog/utils/ordering.ts","store/modules/bklog/utils/blocksUtils.ts","store/modules/bklog/utils/tempStoreUtils.ts","store/modules/bklog/utils/index.ts","store/modules/bklog/index.ts","hooks/useBKlog.ts","components/bklog/utils/index.ts","components/bklog/utils/selectionText.ts","components/bklog/block/ContentEditableEle.tsx","components/bklog/block/ColorStyleToggle.tsx","components/bklog/block/TextStyleToggle.tsx","components/bklog/block/Block.tsx","components/bklog/block/index.ts","index.test.ts","containers/BklogContainer.tsx","pages/BkPage.tsx","pages/AuthPage.tsx","App.tsx","store/modules/counter.ts","store/modules/todos.ts","store/modules/index.ts","store/index.ts","Root.tsx","index.tsx"],"names":["ADD_BLOCK","EDITABLE","addBlock","preBlockId","type","payload","editAble","id","initialState","editingId","blocks","data","temps","newTemps","blocklog","state","action","newBlock","uuidv4","length","nextBlockId","property","styles","contents","i","splice","push","Object","assign","blockId","editingBlock","focusOffset","text","textType","filter","block","console","log","content","tempChange","map","temp","concat","newBlocks","newState","localStorage","setItem","JSON","stringify","preBlock","nextBlock","deletedBlock","idx","preState","getItem","parse","Block","blockData","useSelector","dispatch","useDispatch","blockRef","useRef","onEditable","onDeleteBlock","dragData","e","document","createRange","selObj","window","getSelection","toString","newText","useEffect","current","ele","focus","className","data-id","ref","dangerouslySetInnerHTML","__html","join","contentEditable","onKeyUp","target","innerText","slice","innerHTML","editBlock","key","preventDefault","preId","nextId","onKeyPress","preid","onFocus","onBlur","onMouseUp","onClick","onMouseDown","Blocklog","raw","style","getPostsSaga","postsSaga","getUserInfo","a","axios","method","url","email","password","withCredentials","response","userInfo","name","call","put","takeEvery","withCookies","props","useCookies","NodeDom","node","addNode","useState","editable","setAble","Editor","nodeData","setNodeData","convertType","prop","convertProperty","specialCharacters","convertedWord","word","count","equalsArray","aryA","aryB","Array","isArray","targetBList","targetA","targetBListLength","ii","targetB","arrayFindIndex","array","factor","JSONFactor","addContentsStyle","preTexts","startPoint","endPoint","insertText","newContents","forEach","deleteContentsStyle","stylePosition","newStyle","textStylePosition","converter","parseHtmlContents","textLength","saveToggle","propertyToggle","linkToggle","propertys","shift","pop","undefined","changeStyleTextContents","changedTextStyleBlock","styleType","order","changedTextContents","isFirstBlockPoint","parentBlockId","isNextBlockPoint","orderingBlock","rawBlocks","blockLength","currentPosition","blockIndex","idStack","currentId","findIndex","children","index","insertChild","insertPoint","insertChildren","deleteCount","newChildren","isBlockId","isNotBlockId","blocksUtils","createBlockData","blockType","color","backgroundColor","copyBlockData","copyBlockDataList","blockDataList","newBlockDataList","newPreBlockData","newParentBlockData","parentData","preBlockData","preNextBlockId","insertBlock","preBlocks","parentId","currentBlockId","newChildrenList","preBlockPosition","nextBlockPosition","currentBlockPosition","currentBlock","parentBlockPosition","parentBlock","insertPosion","indexOf","newBlockLastChild","newBlocklastChildPosition","updateContents","stageData","excludeBlock","deletedId","deletedBlocks","newPreBlockId","newNextBlockId","childPositionList","child","firstChild","lastChild","deletePosition","excludeBlockList","blockIdList","nextBlockData","parentPosition","find","switchingBlock","restoreBlock","changedData","childId","childPosition","childChangedData","preParentBlockId","preParentPosition","tempStoreUtils","tempDataPush","tempStore","tempData","limitCount","newTempStore","getContentsToBeChanged","stage","changedBlocks","ordering","pageId","page","userId","rightToEdit","tempBack","tempFront","bklog","newBlockType","addedBlocks","editingBlockId","editingIndex","editedId","editedBlockIndex","preStagedBlock","stagedBlock","newStagedBlock","changedTextStyleBlockIndex","newTempData","newTempBack","switchedId","positionId","switchedBlocks","restoreBlocks","testBlock","useBklog","initBlock","useMemo","getEditAbleId","getStagedBlocks","getRigthToEdit","onAddBlock","useCallback","onEditAble","onEditBlock","onCommitBlock","onChangeTextStyle","changeTextStyle","onSwitchBlock","switchBlock","onRevertBlock","getChilrenBlock","getBlockState","blockState","getStagedBlock","statedBlock","contentsElement","rawContents","aTag","preText","createContentsElement","accumulator","currentIndex","positions","isAfter","container","offset","c","parentNode","previousSibling","compareCaretPositons","node1","offset1","node2","offset2","compareDocumentPosition","Node","DOCUMENT_POSITION_CONTAINED_BY","DOCUMENT_POSITION_CONTAINS","DOCUMENT_POSITION_FOLLOWING","DOCUMENT_POSITION_PRECEDING","stringifyElementStart","isLineStart","tagName","toLowerCase","assert","nodeType","ELEMENT_NODE","TEXT_NODE","nextSibling","getCaretPosition","contenteditable","textPosition","textOffset","lastNode","lastOffset","p","getTextOffset","selectionNode","selectionOffset","setSelectionRange","start","end","selection","s","setBaseAndExtent","getSelectionStart","anchorNode","anchorOffset","focusNode","getSelectionEnd","ContentEditableEle","React","forwardRef","onMouseMove","placeholder","ColorStyleToggleButton","colorCode","onStyleChange","addDelToggle","RGBA","btnStyle","addDel","colorCodes","ColorStyleToggle","code","textBlockType","TextBlockTypeSelection","TextStyleToggleButton","addDelClassName","TextStyleToggles","startPosition","endPosition","reBlockFocus","useBKlog","toggle","includedStyle","textContents","position","findTextStyle","cursorStart","setCursorStart","cursorEnd","setCursorEnd","styleToggle","setStyleToggle","createMarkup","reduce","childrenBlock","refreshPoint","handleFocus","focused","activeElement","data-index","currentTarget","contains","relatedTarget","getStartPosition","getEndPosition","moveEndPoint","TextStyleToggle","TEST_BLOCKS","TEST_BLOCKDATALIST","TEST_CASE_01","newDataList","aaa","testDataList","testDataIdList","insertedBlock","newInsertedBlock","testCopyBlockList","BklogContainer","setCount","getLastActiveTime","useIdleTimer","timeout","onIdle","debounce","BkPage","match","mode","params","classNames","AuthPage","to","App","basename","path","component","Home","exact","counter","createAction","createReducer","todos","done","todo","rootSage","all","rootReducer","combineReducers","auth","sagaMiddleware","createSagaMiddleware","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","configureStore","store","createStore","applyMiddleware","run","Root","CookiesProvider","ReactDOM","render","getElementById"],"mappings":"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mB,MAAhB3G,EAAK2G,GACN,OAAOD,GACL,IAAK,SACHD,EAAa,IACb,MACF,IAAK,QACHA,EAAgB,IAChB,MACF,IAAK,OACHA,EAAgB,IAChB,MACF,IAAK,OACHA,EAAgB,IAChB,MACF,IAAK,SACHA,EAAgB,IAChB,MACF,IAAK,UACHA,EAAgB,OAChB,MACF,IAAK,SACHA,EAAgB,SAChB,MACF,IAAK,UACHA,EAAgB,SAChB,MACF,IAAK,WACHA,EAAgB,OAChB,MACF,IAAK,QACHA,EAAgB,SAChB,MACF,IAAK,WACHA,EAAgB,IAChB,MACF,IAAK,SACHA,EAAgB,OAChB,MACF,IAAK,QACHA,EAAgB,OAChB,MACF,IAAK,SACHA,EAAgB,SAChB,MACF,IAAK,SACHA,EAAgB,OAChB,MACF,IAAK,UACHA,EAAgB,SAChB,MACF,IAAK,QACHA,EAAgB,SAChB,MACF,IAAK,QACHA,EAAgB,IAChB,MACF,IAAK,QACHA,EAAgB,IAChB,MACF,IAAK,SACHA,EAAgBC,EAChB,MACF,IAAK,QACHD,EAAgB,OAChB,MACF,IAAK,WACHA,EAAgB,OAChB,MACF,IAAK,SACHA,EAAgB,OAChB,MACF,IAAK,SACHA,EAAgB,OAChB,MACF,IAAK,SACHA,EAAgB,OAChB,MACF,IAAK,UACHA,EAAgB,OAChB,MACF,IAAK,UACHA,EAAgB,SAChB,MACF,IAAK,SACHA,EAAgB,OAChB,MACF,IAAK,WACHA,EAAgB,OAChB,MACF,IAAK,UACHA,EAAgB,OAChB,MACF,IAAK,SACHA,EAAgB,OAChB,MACF,IAAK,UACHA,EAAgB,SAChB,MACF,IAAK,WACHA,EAAgB,OAChB,MACF,IAAK,WACHA,EAAgB,OAChB,MACF,IAAK,WACHA,EAAgB,OAChB,MACF,IAAK,WACHA,EAAgB,OAChB,MACF,IAAK,WAGL,IAAK,WAGL,IAAK,UAGL,IAAK,WAGL,IAAK,SAGL,IAAK,UACHA,EAAgB,IAChB,MACF,IAAK,UACHA,EAAgB,OAChB,MACF,IAAK,WACHA,EAAgB,IAChB,MACF,IAAK,WAGL,IAAK,WAGL,IAAK,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","file":"static/js/main.62741c91.chunk.js","sourcesContent":["import { v4 as uuidv4 } from 'uuid';\n\nimport { data } from '../../../data/dummy.json';\n\nexport interface BlockProp {\n  type: string;\n  styles?: {\n    color?: string;\n    backgroundColor?: string;\n  }\n  contents: any[];\n}\n\nexport type UUID = ReturnType<typeof uuidv4>\n\nexport interface RawBlock {\n  id: UUID | string;\n  preBlockId: UUID | string | null;\n  nextBlockId: UUID | string | null;\n  property: BlockProp;\n}\n\nconst ADD_BLOCK    = 'blocklog/ADD_BLOCK' as const;\nconst EDITABLE     = 'blocklog/EDITABLE' as const; \nconst EDIT_BLOCK   = 'blocklog/EDIT_BLOCK' as const; // 임시 데이터로 이동\nconst COMMIT_BLOCK = 'blocklog/COMMIT_BLOCK' as const;\nconst DELETE_BLOCK = 'blocklog/DELETE_BLOCK' as const;\nconst UPDATE_BLOCK = 'blocklog/UPDATE_BLOCK' as const; // DB에 업데이트할 때\nconst SWITCH_BLOCK = 'blocklog/SWITCH_BLOCK' as const;\n\nconst NEWEDIT_BLOCK = 'blocklog/NEWEDIT_BLOCK' as const;\n\ninterface EditedBlock {\n  blockId: UUID,\n  focusOffset: number,\n  text: string,\n  textType: \"b\" | \"i\" \n}\n\nexport function newEditBlock({ \n  blockId,\n  focusOffset,\n  text,\n  textType\n}: EditedBlock) {\n  return {\n    type: NEWEDIT_BLOCK,\n    payload: {\n      blockId,\n      focusOffset,\n      text,\n      textType\n    }\n  }\n}\n\nexport function addBlock(preBlockId?: string, type?: string) {\n  return {\n    type: ADD_BLOCK,\n    payload: {\n      preBlockId,\n      type\n    }\n  }\n}\n\nexport function editAble (id: UUID) {\n  return {\n    type: EDITABLE,\n    payload: {\n      id\n    }\n  }\n}\n\nexport function editBlock(id:UUID, content: string) {\n  return {\n    type: EDIT_BLOCK,\n    payload: {\n      id,\n      content\n    }\n  }\n}\n\nexport function commitBlock() {\n  return {\n    type: COMMIT_BLOCK\n  }\n}\n\nexport function deleteBlock(id: UUID) {\n  return {\n    type: DELETE_BLOCK,\n    payload: {\n      id\n    }\n  }\n}\n\nexport function updateBlock(id: UUID) {\n  return {\n    type: UPDATE_BLOCK,\n    payload: {\n      id\n    }\n  }\n}\n\nexport type BlocklogActions = ReturnType<typeof addBlock>\n  | ReturnType<typeof editAble>\n  | ReturnType<typeof editBlock>\n  | ReturnType<typeof commitBlock>\n  | ReturnType<typeof deleteBlock>\n  | ReturnType<typeof updateBlock>\n  | ReturnType<typeof newEditBlock>\n;\n\ninterface TempData {\n  id: UUID;\n  content: string;\n}\n\ninterface NewTemps {\n  id: UUID;\n  content: string;\n  startOffset: number;\n  lastOffset: number;\n}\n\nexport interface BlocklogState {\n  editingId: string | null;\n  blocks: RawBlock[];\n  temps: TempData[];\n  newTemps: NewTemps[];\n}\n\nexport interface Content {\n  content: [\n    string,\n    [\n      string[],\n      string[]?\n    ]?\n  ]\n}\n\n\n// 먼저 기존 기능 대체\nfunction newContents (\n    preContents:any, \n    focusOffset:number, \n    textLength: number,\n    newContent: any\n  ):any  {\n    let contents = [...preContents];\n    let newContents = []\n    let temp = []\n    \n    newContents = [contents.slice(0, focusOffset)];\n\n    for (let i = focusOffset; i < textLength; i++ ) {\n      \n    }\n\n\n  return {\n    contents: [\"aa\", [[\"aa\"]]]\n  }\n}\n\nconst initialState:BlocklogState = (():BlocklogState => {\n  return {\n    editingId: null,\n    blocks: [...data],\n    temps: [],\n    newTemps: []\n  };\n})()\n\nfunction blocklog( state: BlocklogState = initialState, action: BlocklogActions):BlocklogState {\n\n  switch(action.type) {\n\n    case ADD_BLOCK:\n      \n      const { preBlockId, type } = action.payload;\n\n      const blocks = [...state.blocks];\n\n      const newBlock: RawBlock = {\n        id: uuidv4(),\n        preBlockId: preBlockId?  preBlockId : state.blocks[state.blocks.length - 1].id,\n        nextBlockId: null,\n        property: {\n          type: type? type : \"BKlog-p\",\n          styles: {\n          },\n          contents: [\n          ]\n        }\n      }\n\n      if(preBlockId) {\n\n        newBlock.preBlockId = preBlockId;\n\n        for(let i = 0; i < state.blocks.length; i++) {\n          if(state.blocks[i].id === preBlockId) {\n\n            if(i !== state.blocks.length - 1 ) {\n          \n              blocks[i].nextBlockId = newBlock.id;\n              blocks[i+1].preBlockId = newBlock.id;\n              newBlock.nextBlockId = blocks[i+1].id;\n  \n              blocks.splice(i + 1, 0, newBlock);\n\n            } else {\n\n              blocks[i].nextBlockId = newBlock.id;\n\n              blocks.push(newBlock);\n\n            }\n            \n          }\n        }\n\n        return Object.assign({}, state, {\n          blocks,\n          editingId: newBlock.id\n        })\n      }\n\n      blocks[blocks.length -1].nextBlockId = newBlock.id;\n      \n      blocks.push(newBlock);\n      \n      return Object.assign({}, state, {\n        blocks,\n        editingId: newBlock.id\n      });\n\n    case EDITABLE: \n      return Object.assign({}, state, {\n        editingId: action.payload.id\n      })\n\n    case NEWEDIT_BLOCK:\n      const { blockId, focusOffset, text, textType } = action.payload;\n      const editingBlock = state.blocks.filter(block => \n          block.id === blockId\n        )[0];\n\n      console.log(editingBlock);\n\n      return state;\n    \n    case EDIT_BLOCK: \n\n      const { id, content } = action.payload;\n\n      let tempChange = false;\n\n      for(let i = 0; i < state.temps.length; i++) {\n        if(state.temps[i].id === id) {\n          tempChange = true;\n          \n          break;\n        }\n      }\n\n      return Object.assign({}, state, {\n        temps: tempChange? state.temps.map(temp => \n            temp.id === id? {\n              id,\n              content\n            } : temp\n          ): [...state.temps, {\n            id,\n            content\n          }]\n      });\n\n    case COMMIT_BLOCK: \n      const temps = state.temps.concat();\n\n      const newBlocks = state.blocks.map((block)=> {\n\n          for(let i = 0; i < temps.length; i++) {\n\n            if(block.id === temps[i].id) {\n\n              return Object.assign({}, block, {\n                property: Object.assign({}, block.property, {\n                  contents: [\n                    temps[i].content\n                  ]\n                })\n              });\n\n            }\n          }\n\n          return block;\n        });\n      \n      const newState = Object.assign({}, state, {\n        blocks: newBlocks,\n        temps: [],\n        editingId: null\n      });\n\n      localStorage.setItem(\"blocklog\", JSON.stringify(newState));\n\n      return newState;\n\n    case DELETE_BLOCK: \n      const deletedBlock = state.blocks.filter((block)=>\n        block.id !== action.payload.id\n      );\n      \n      let preBlock, nextBlock;\n\n      if(deletedBlock.length === 0) {\n      \n        deletedBlock.push({\n          id: uuidv4(),\n          preBlockId: null,\n          nextBlockId: null,\n          property: {\n            type: \"BKlog-p\",\n            styles: {\n            },\n            contents: [\n            ]\n          }\n        })\n\n      } else {\n\n        for(let i = 0; i < deletedBlock.length; i++) {\n\n          if(i === 0) {\n            if(state.blocks[i].id === action.payload.id) {\n              deletedBlock[i].preBlockId = null\n              break;\n            }\n          } else if(i === deletedBlock.length - 1 ) {\n            if(state.blocks[i+1].id === action.payload.id) {\n              deletedBlock[i].nextBlockId = null\n            }\n          }\n\n          if(deletedBlock[i].nextBlockId === action.payload.id) {\n            preBlock = {\n              idx: i,\n              id: deletedBlock[i].id\n            }\n          }\n  \n          if(deletedBlock[i].preBlockId === action.payload.id) {\n            nextBlock = {\n              idx: i,\n              id: deletedBlock[i].id\n            }\n          }\n\n        }\n  \n        if(preBlock && nextBlock) {\n          deletedBlock[preBlock.idx].nextBlockId = nextBlock.id\n          deletedBlock[nextBlock.idx].preBlockId = preBlock.id\n        } \n\n      }\n\n      return Object.assign({}, state, {\n        blocks: deletedBlock\n      })\n\n\n    default: \n      let preState = localStorage.getItem(\"blocklog\")\n\n      return preState? JSON.parse(preState) : state;\n  }\n\n}\n\nexport default blocklog;","import React, { useEffect, useRef, useState } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\n\nimport { RootState } from '../../store/modules';\nimport { \n  BlockProp, \n  addBlock, \n  editAble,\n  editBlock, \n  commitBlock, \n  deleteBlock,\n  BlocklogState, \n  UUID\n} from '../../store/modules/blocklog';\n\ninterface BlockRaw {\n  id: string;\n  preId: string | null;\n  nextId: string | null;\n  type: string;\n  style?: any[];\n  contents: string[];\n}\n\ninterface BlockProps {\n  blockData: BlockRaw;\n}\n\nfunction Block({blockData}:BlockProps) {\n\n  const state:BlocklogState = useSelector(( state: RootState) => state.blocklog);\n\n  const dispatch = useDispatch();  \n\n  const blockRef = useRef<null>(null);\n\n  const onAddBlock = (preid?: UUID, type?: string) => {\n    dispatch(addBlock(preid, type));\n  }\n\n  const onEditable = () => {\n    dispatch(editAble(blockData.id));\n  }\n\n  const onEditBlock = (id: string, content: string) => {\n    dispatch(editBlock(id, content));\n  }\n\n  const onCommitBlock = () => {\n    dispatch(commitBlock());\n  }\n  \n  const onDeleteBlock = () => {\n    dispatch(deleteBlock(blockData.id));\n  }\n\n  const createMarkup = () => {\n    return {\n      __html: \n      blockData.contents?\n      blockData.contents.join()\n      : \"\"\n    }\n  }\n\n  const editContent = (e:any) => {\n    \n    const selObj = window.getSelection();\n    const range = document.createRange();\n    \n    // Select paragraph\n    const focusOffset = selObj? selObj.focusOffset : 0;\n   \n    console.log(focusOffset, selObj? selObj.toString() : \"없음\", e.target.innerText.slice(focusOffset -2, focusOffset));\n\n    onEditBlock(blockData.id, e.target.innerHTML);\n\n    switch(e.key) {\n \n      case \"Enter\":\n        e.preventDefault();\n        break;\n\n      case \"ArrowUp\": \n        if(blockData.preId) dispatch(editAble(blockData.preId))\n        break;\n\n      case \"ArrowDown\":\n        if(blockData.nextId) dispatch(editAble(blockData.nextId));\n        break;\n\n      case \"Backspace\":\n        if(!e.target.innerHTML) {\n          onDeleteBlock();\n          if(blockData.preId) dispatch(editAble(blockData.preId))\n          else if(blockData.nextId) { dispatch(editAble(blockData.nextId))};\n          break;\n        }\n\n    }\n\n  }\n\n  const addContent = (e:any) => {\n    if(e.key === \"Enter\") {\n      e.preventDefault();\n      onAddBlock(blockData.id);\n    }\n  }\n\n  const changeTextStyle = (text:string, type: string) => {\n    return [\n      text,\n      type\n    ]\n  }\n\n  const dragData = (e:any) => {\n    const range = document.createRange();\n    const selObj = window.getSelection()\n    const data = selObj? selObj.toString() : \"없음\";\n    const focusOffset = selObj? selObj.focusOffset : null;\n\n    const newText = changeTextStyle(data, \"b\");\n\n    console.log(newText);\n  \n    // if(focusOffset) {\n    //   const newBlock = blockData.contents.concat().join();\n    //   const newData =  newBlock.replace(data, `<strong>${data}</strong>`);\n    //   onEditBlock(blockData.id, newData);\n    //   console.log(newData, \"ㅁㄴㅇㅁㄴㅇ\");\n    //   console.log(\"dsadsd\")\n    // }\n  }\n\n  const focus = (ele: any) => {\n    const selObj = window.getSelection();\n    const range = document.createRange();\n    \n    ele.focus();\n    // if(ele.childNodes[0] && blockData.contents.join().length > 0) {\n    //   range.setStart(ele.childNodes[0], 3);\n    //   range.setEnd(ele.childNodes[0], 4);\n    // }  \n    // console.log(ele.childNodes[0], blockData.contents.join().length);\n  }\n\n  useEffect(()=> {\n   if(state.editingId === blockData.id && blockRef.current ) {\n    focus(blockRef.current)\n   }\n  },[state.editingId]);\n\n  return (\n    <div id={blockData.id} className=\"block-zone\">\n      <div \n        data-id={blockData.id}\n        ref={blockRef}\n        className={blockData.type}\n        dangerouslySetInnerHTML={createMarkup()}  \n        contentEditable={true}\n        onKeyUp={editContent}\n        onKeyPress={addContent}\n        onFocus={onEditable}\n        onBlur={onCommitBlock}\n        onMouseUp={dragData}\n        onClick={onEditable}\n        onMouseDown={dragData}\n      >\n      </div>\n      <button onClick={onDeleteBlock}> 삭제 </button>\n    </div>\n  )\n}\n\nfunction Blocklog() {\n\n  const state:BlocklogState = useSelector(( state: RootState) => state.blocklog);\n  const dispatch = useDispatch();  \n\n  const onAddBlock = (preid?: any, type?: string) => {\n    dispatch(addBlock(preid, type));\n  }\n\n  const click = () => {\n    onAddBlock();\n  }\n\n  const blockData = state? state.blocks.map( raw => {\n    return {\n      id: raw.id,\n      preId: raw.preBlockId,\n      nextId: raw.nextBlockId,\n      type: raw.property.type,\n      style: [],\n      contents: raw.property.contents\n    }\n  }) : null;\n\n  return (\n    <div className=\"blocklog\">\n      {\n        blockData?\n        blockData.map((block)=> \n          <Block \n            blockData={block}\n            key={block.id}\n          />\n        ) : <div>\"\"</div>\n      }\n      <button onClick={click}>블럭 추가</button>\n    </div>\n  )\n}\n\nexport default Blocklog;","import { AuthState, SIGNIN, SIGNIN_ASYNC } from './utils';\nimport { call, delay, put, takeEvery } from 'redux-saga/effects';\nimport axios from 'axios';\n\nconst sleep = (n: number) => new Promise(resolve => resolve);\n\nconst posts = [\n  {\n    id: 1,\n    title: '리덕스 미들웨어를 배워봅시다',\n    body: '리덕스 미들웨어를 직접 만들어보면 이해하기 쉽죠.'\n  },\n  {\n    id: 2,\n    title: 'redux-thunk를 사용해봅시다',\n    body: 'redux-thunk를 사용해서 비동기 작업을 처리해봅시다!'\n  },\n  {\n    id: 3,\n    title: 'redux-saga도 사용해봅시다',\n    body:\n      '나중엔 redux-saga를 사용해서 비동기 작업을 처리하는 방법도 배워볼 거예요.'\n  }\n];\n\n// 포스트 목록을 가져오는 비동기 함수\nexport const TestPosts = async () => {\n  await sleep(500); // 0.5초 쉬고\n  return posts; // posts 배열\n};\n\n// ID로 포스트를 조회하는 비동기 함수\nexport const TestPostById = async (id: any) => {\n  await sleep(500); // 0.5초 쉬고\n  return posts.find(post => post.id === id); // id 로 찾아서 반환\n};\n\nexport const getPosts = () => async () => {\n  try {\n    const posts = TestPosts(); // API 호출\n    console.log(posts);\n    return {\n      email: \"test@test.com\",\n      name: \"test\"\n    }\n  } catch (e) {\n    console.log(\"test\");\n  }\n};\n \nasync function getUserInfo() {\n  try {\n    const response = await axios({\n      method: \"post\",\n      url: 'http://localhost:4500/v2/user/login',\n      data: {\n        email: \"test@test.com\",\n        password: \"Password123!\"\n      },\n      withCredentials: true\n    });\n\n    console.log(response);\n\n    const userInfo: {\n      email: string,\n      name: string\n    } = {\n      email: response.data.data.email,\n      name: response.data.data.name\n    }\n\n    console.log(\"userInfo\",userInfo);\n\n    return userInfo;\n  } catch(e) {\n    console.log(e);\n    return null\n  }\n  \n}\n\nfunction* getPostsSaga() {\n  try {\n    const data = yield call(getUserInfo);\n    console.log(\"data\", data);\n    yield put(signInUser({\n      email: data.email,\n      name: data.name\n    }));\n  } catch(e) {\n    console.log(e);\n  }\n}\n\nexport function* postsSaga() {\n  yield takeEvery(SIGNIN_ASYNC, getPostsSaga);\n}\n\nexport const signInAsync = () => {\n  return {type: SIGNIN_ASYNC}\n}\n\ntype UserInfo = {\n  email: string;\n  name: string;\n}\n\nexport function signInUser(userInfo: UserInfo) {\n  return {\n    type: SIGNIN,\n    payload: {\n      email: userInfo.email,\n      name: userInfo.name\n    }\n  }\n}\n\nexport function signInUserAsync() {\n  return {\n    type: SIGNIN_ASYNC\n  }\n}\n\nexport type AuthActions = ReturnType<typeof signInUser>\n  | ReturnType<typeof signInUserAsync>;\n\nconst initialState: AuthState = (() => {\n  return {\n    email: \"test@naver.com\",\n    name: \"test\"\n  }\n})();\n\nexport default function auth(state: AuthState = initialState, action: AuthActions) {\n  switch (action.type) {\n    case SIGNIN:\n      console.log(action);\n      return Object.assign({}, state, {\n        email: action.payload.email,\n        name: action.payload.name\n      });\n  \n    default:\n      return state;\n  }\n}","export const SIGNUP = \"auth/SIGNUP\" as const;\nexport const SIGNIN = \"auth/SIGNIN\" as const;\nexport const SIGNIN_ASYNC = \"auth/SIGNIN_ASYNC\" as const;\n\nexport interface AuthState {\n  email: string;\n  name: string;\n}","import React, { useEffect } from 'react';\nimport Form from '../components/Form';\nimport Blocklog from '../components/bklog/Blocklog';\nimport { useDispatch } from 'react-redux';\nimport { signInAsync } from '../store/modules/auth/index';\nimport { useCookies, withCookies } from 'react-cookie';\n\nfunction Home(props: any) {\n  const [cookie, setCookie] = useCookies([\"cert\"]);\n\n  const dispatch = useDispatch();\n\n  const handleClick = () => {\n    dispatch(signInAsync());\n  }\n\n  // useEffect(()=> {\n  //   console.log(props.cookies);\n  //   setCookie('cert', \"dsad\", { path: '/'});\n  // }, [props.cookies])\n\n  return (\n    <div className=\"home\">\n      {/* <Form \n        formType=\"number\"\n        errorMessage=\"숫자를 입력해주세요.\"\n      />\n      <Form \n        formType=\"text\"\n        errorMessage=\"문자를 입력해주세요.\"\n      />\n      <Form \n        formType=\"password\"\n        errorMessage=\"비밀번호를 입력해주세요.\"\n      /> */}\n      <Blocklog />\n      <button onClick={handleClick}> \n        테스트\n      </button>\n    </div>\n  )\n}\n\nexport default withCookies(Home);","import React, { useState } from \"react\";\n\ninterface Node {\n  id: string;\n  type: string; // class에 들어가거나 타입에 따라 작동 방식을 넣을 것.\n  content: string; \n}\n\ninterface NodeDomDefaultProps {\n  node: Node;\n  addNode: any\n}\n\n\nfunction NodeDom({ node, addNode }:NodeDomDefaultProps) {\n\n  const { id, type, content }  = node;\n  const [ editable, setAble ] = useState<boolean>(false);\n\n  const setEdit = (e:any) => {\n    if(e.key === \"Enter\") {\n      setAble(false);\n      addNode(e);\n    }\n  }\n  const editing = () => {\n    setAble(true);\n  }\n\n  return (\n    <div \n      className={type} \n      data-id={id} \n      contentEditable={editable}\n      onKeyPress={setEdit}\n      onClick={editing}\n    >\n      {content}\n    </div>\n  )\n}\n\nfunction Editor() {\n\n  const [ nodeData, setNodeData ] = useState<Node[]>([{\n    type: \"text\",\n    content: \"asdsd\",\n    id: \"123\"\n  }]);\n\n  const addNode = (e:any) => {\n    console.log(e.key);\n    if(e.key === \"Enter\") {\n      const data = nodeData.concat();\n      data.push({\n        type: \"text\",\n        content: \"asdsd\",\n        id: \"123\"\n      })\n      console.log(data);\n      setNodeData(data);\n    }\n  }\n\n  return (\n    <div>\n      {\n        nodeData? \n        nodeData.map((node, idx) => \n          <NodeDom \n            node={node}\n            key={idx}\n            addNode={addNode}\n          />\n        )\n        : \"Loading...\"\n      }\n      <textarea onKeyPress={addNode}></textarea>\n    </div>\n  )\n}\n\nexport default Editor;","import { \n  ContentType, \n  TextContents, \n  BlockData,\n  TextProps\n} from '../../../../types/bklog';\nimport { OrderType } from '.';\n\nconst BOLD = \"b\" as const;\nconst ITALY = \"i\" as const;\nconst UNDERBAR = \"_\" as const;\nconst FONT_COLOR = \"fc\" as const;\nconst BACKGROUND_COLOR = \"bc\" as const;\nconst ANCHOR = \"a\" as const;\nconst FONT = \"f\" as const;\n\nconst BK_BOLB = \"bk-bold\";\nconst BK_ITALIC = \"bk-italic\";\nconst BK_UNDER = \"bk-underbar\";\nconst BK_COLOR = \"color\";\nconst BK_BACKGROUND_COLOR = \"background-color\";\n\nconst FONT_WEIGHT = \"font-weight\";\nconst FONT_STYLE = \"font-style\";\nconst TEXT_DECORATION = \"text-decoration\";\nconst BOLDER_BOTTOM = \"border-bottom\";\n\nfunction convertType(prop: string):any {\n  switch(prop) {\n    case BK_BOLB:\n      return BOLD;\n    case BK_ITALIC:\n      return ITALY;\n    case BK_UNDER:\n      return UNDERBAR;\n    case BK_COLOR:\n      return FONT_COLOR;\n    case BK_BACKGROUND_COLOR:\n      return BACKGROUND_COLOR;\n    case BOLDER_BOTTOM:\n      return UNDERBAR;\n    default:\n      return null;\n  }\n}\n\n/**\n * \n * @param prop \n */\nfunction convertProperty(prop: string):any {\n  switch(prop) {\n    case \"700\":\n      return BOLD;\n    case \"italic\":\n      return ITALY;\n    default:\n      return prop;\n  }\n}\n\n/**\n * html 특수문자 컨버팅 함수\n * @param text \n * @param i \n */\nfunction specialCharacters(\n  text: string, \n  i: number\n  ): { word: string, count: number } {\n\n  let word:string = text[i];\n  let convertedWord: string;\n  let count = i + 1;\n  let length = text.length;\n\n  while(text[count] !== \" \" && text[count] !== \"&\" && count < length) {\n    word += text[count];\n    if(text[count] === \";\") break;\n    count++;\n  }\n\n  if(text[count] === \";\") {\n    switch(word) {\n      case \"&quot;\": \n        convertedWord = `\"`;\n        break;\n      case \"&amp;\":\n        convertedWord = \"&\";\n        break;\n      case \"&lt;\":\n        convertedWord = \"<\";\n        break;\n      case \"&gt;\":\n        convertedWord = \">\";\n        break;\n      case \"&nbsp;\":\n        convertedWord = \" \";\n        break;\n      case \"&iexcl;\":\n        convertedWord = \"¡\";\n        break;\n      case \"&cent;\":\n        convertedWord = \"￠\";\n        break;\n      case \"&pound;\":\n        convertedWord = \"￡\";\n        break;\n      case \"&curren;\":\n        convertedWord = \"¤\";\n        break;\n      case \"&yen;\":\n        convertedWord = \"￥\";\n        break;\n      case \"&brvbar;\":\n        convertedWord = \"|\";\n        break;\n      case \"&sect;\":\n        convertedWord = \"§\";\n        break;\n      case \"&uml;\":\n        convertedWord = \"¨\";\n        break;\n      case \"&copy;\":\n        convertedWord = \"ⓒ\";\n        break;\n      case \"&ordf;\":\n        convertedWord = \"ª\";\n        break;\n      case \"&laquo;\":\n        convertedWord = \"≪\";\n        break;\n      case \"&not;\":\n        convertedWord = \"￢\";\n        break;\n      case \"&shy;\":\n        convertedWord = \"-\";\n        break;\n      case \"&reg;\":\n        convertedWord = \"?\";\n        break;\n      case \"&macr;\":\n        convertedWord = word;\n        break;\n      case \"&deg;\":\n        convertedWord = \"°\";\n        break;\n      case \"&plusmn;\":\n        convertedWord = \"±\";\n        break;\n      case \"&sup1;\":\n        convertedWord = \"¹\";\n        break;\n      case \"&sup2;\":\n        convertedWord = \"²\";\n        break;\n      case \"&sup3;\":\n        convertedWord = \"³\";\n        break;\n      case \"&acute;\":\n        convertedWord = \"´\";\n        break;\n      case \"&micro;\":\n        convertedWord = \"μ\";\n        break;\n      case \"&para;\":\n        convertedWord = \"¶\";\n        break;\n      case \"&middot;\":\n        convertedWord = \"·\";\n        break;\n      case \"&cedil;\":\n        convertedWord = \"¸\";\n        break;\n      case \"&ordm;\":\n        convertedWord = \"º\";\n        break;\n      case \"&raquo;\":\n        convertedWord = \"≫\";\n        break;\n      case \"&frac14;\":\n        convertedWord = \"¼\";\n        break;\n      case \"&frac12;\":\n        convertedWord = \"½\";\n        break;\n      case \"&frac34;\":\n        convertedWord = \"¾\";\n        break;\n      case \"&iquest;\":\n        convertedWord = \"¿\";\n        break;\n      case \"&Agrave;\":\n        convertedWord = \"A\";\n        break;\n      case \"&Aacute;\":\n        convertedWord = \"A\";\n        break;\n      case \"&Acirc;\":\n        convertedWord = \"A\";\n        break;\n      case \"&Atilde;\":\n        convertedWord = \"A\";\n        break;\n      case \"&Auml;\":\n        convertedWord = \"A\";\n        break;\n      case \"&Aring;\":\n        convertedWord = \"A\";\n        break;\n      case \"&AElig;\":\n        convertedWord = \"Æ\";\n        break;\n      case \"&Ccedil;\":\n        convertedWord = \"C\";\n        break;\n      case \"&Egrave;\":\n        convertedWord = \"E\";\n        break;\n      case \"&Eacute;\":\n        convertedWord = \"E\";\n        break;\n      case \"&Ecirc;\":\n        convertedWord = \"E\";\n        break;\n      case \"&Euml;\":\n        convertedWord = \"E\";\n        break;\n      case \"&Igrave;\":\n        convertedWord = \"I\";\n        break;\n      case \"&Iacute;\":\n        convertedWord = \"I\";\n        break;\n      case \"&Icirc;\":\n        convertedWord = \"I\";\n        break;\n      case \"&Iuml;\":\n        convertedWord = \"I\";\n        break;\n      case \"&ETH;\":\n        convertedWord = \"Ð\";\n        break;\n      case \"&Ntilde;\":\n        convertedWord = \"N\";\n        break;\n      case \"&Ograve;\":\n        convertedWord = \"O\";\n        break;\n      case \"&Oacute;\":\n        convertedWord = \"O\";\n        break;\n      case \"&Ocirc;\":\n        convertedWord = \"O\";\n        break;\n      case \"&Otilde;\":\n        convertedWord = \"O\";\n        break;\n      case \"&Ouml;\":\n        convertedWord = \"O\";\n        break;\n      case \"&times;\":\n        convertedWord = \"×\";\n        break;\n      case \"&Oslash;\":\n        convertedWord = \"Ø\";\n        break;\n      case \"&Ugrave;\":\n        convertedWord = \"U\";\n        break;\n      case \"&Uacute;\":\n        convertedWord = \"U\";\n        break;\n      case \"&Ucirc;\":\n        convertedWord = \"U\";\n        break;\n      case \"&Uuml;\":\n        convertedWord = \"U\";\n        break;\n      case \"&Yacute;\":\n        convertedWord = \"Y\";\n        break;\n      case \"&THORN;\":\n        convertedWord = \"Þ\";\n        break;\n      case \"&szlig;\":\n        convertedWord = \"ß\";\n        break;\n      case \"&agrave;\":\n        convertedWord = \"a\";\n        break;\n      case \"&aacute;\":\n        convertedWord = \"a\";\n        break;\n      case \"&acirc;\":\n        convertedWord = \"a\";\n        break;\n      case \"&atilde;\":\n        convertedWord = \"a\";\n        break;\n      case \"&auml;\":\n        convertedWord = \"a\";\n        break;\n      case \"&aring;\":\n        convertedWord = \"a\";\n        break;\n      case \"&aelig;\":\n        convertedWord = \"æ\";\n        break;\n      case \"&ccedil;\":\n        convertedWord = \"c\";\n        break;\n      case \"&egrave;\":\n        convertedWord = \"e\";\n        break;\n      case \"&eacute;\":\n        convertedWord = \"e\";\n        break;\n      case \"&ecirc;\":\n        convertedWord = \"e\";\n        break;\n      case \"&euml;\":\n        convertedWord = \"e\";\n        break;\n      case \"&igrave;\":\n        convertedWord = \"i\";\n        break;\n      case \"&iacute;\":\n        convertedWord = \"i\";\n        break;\n      case \"&icirc;\":\n        convertedWord = \"i\";\n        break;\n      case \"&iuml;\":\n        convertedWord = \"i\";\n        break;\n      case \"&eth;\":\n        convertedWord = \"ð\";\n        break;\n      case \"&ntilde;\":\n        convertedWord = \"n\";\n        break;\n      case \"&ograve;\":\n        convertedWord = \"o\";\n        break;\n      case \"&oacute;\":\n        convertedWord = \"o\";\n        break;\n      case \"&ocirc;\":\n        convertedWord = \"o\";\n        break;\n      case \"&otilde;\":\n        convertedWord = \"o\";\n        break;\n      case \"&ouml;\":\n        convertedWord = \"o\";\n        break;\n      case \"&divide;\":\n        convertedWord = \"÷\";\n        break;\n      case \"&oslash;\":\n        convertedWord = \"ø\";\n        break;\n      case \"&ugrave;\":\n        convertedWord = \"u\";\n        break;\n      case \"&uacute;\":\n        convertedWord = \"u\";\n        break;\n      case \"&ucirc;\":\n        convertedWord = \"u\";\n        break;\n      case \"&uuml;\":\n        convertedWord = \"u\";\n        break;\n      case \"&yacute;\":\n        convertedWord = \"y\";\n        break;\n      case \"&thorn;\":\n        convertedWord = \"þ\";\n        break;\n      case \"&yuml;\":\n        convertedWord = \"y\";\n        break;\n\n      default: \n        convertedWord = word;\n    }\n  } else {\n    convertedWord = text[i];\n    count = i;\n  }\n\n  return {\n    word: convertedWord,\n    count\n  };\n}\n\nfunction parseHtmlContents(text:string):TextContents[] {\n\n  const newContents: any[] = [];\n  const textLength: number = text.length;\n\n  console.log(text);\n\n  let saveToggle:boolean = true;\n\n  let content: any = [];\n\n  let propertyToggle:boolean = false;\n  let linkToggle:boolean = false;\n\n  let propertys: any[] = [];\n  let property: string | null = null;\n  let type: string[] = [];\n\n  for(let i = 0; i < textLength; i++) {\n\n    if(!propertyToggle && !linkToggle) {\n\n      switch(text[i]) {\n        case \"<\": \n  \n          if(i && text[i+1] === \"/\" && (text[i+6] === \">\" || text[i+2] === \"a\")) {\n            if(content[0]) {\n              newContents.push(content);\n              content = [];\n            }\n            if(text[i+6] === \">\") {\n              i += 6;\n            } else {\n              i += 3;\n            }\n          \n            saveToggle = true;\n\n          } else {\n\n            saveToggle = false;\n  \n            if(content[0] !== undefined) {\n              newContents.push(content);\n              content = [];\n            } \n\n            if(text[i+1] === \"s\") {\n              i += 4;\n            } else if(text[i+1] === ANCHOR) {\n              i += 1;\n            }\n         \n          }\n  \n          break;\n        case \">\":\n          saveToggle = true;\n\n          break;\n  \n        case \"s\":\n  \n          if(!saveToggle) {\n           if(text[i+1] === \"t\" && text[i+5] === \"=\") {\n             i += 6;\n             propertyToggle = true;\n           }\n          } else {\n            content[0]? content[0] += text[i] : content[0] = text[i];\n          }\n\n          break;\n  \n        case \"c\":\n          if(!saveToggle) {\n            if(text[i+1] === \"l\" && text[i+5] === \"=\") {\n              i += 6;\n              propertyToggle = true;\n            }\n          } else {\n            content[0]? content[0] += text[i] : content[0] = text[i];\n          }\n\n          break;\n        \n        case \"h\":\n          if(!saveToggle) {\n            if(text[i+1] === \"r\" && text[i+3] === \"f\") {\n              i += 5;\n              linkToggle = true;\n            }\n    \n          } else {\n            content[0]? content[0] += text[i] : content[0] = text[i];\n          }\n\n          break;\n        \n        case \"&\":\n          const { word, count } = specialCharacters(text, i);\n          i = count;\n          content[0]? content[0] += word : content[0] = word;\n  \n          break;\n        \n        // chrome 번역기 동작시 font 태그가 주입될때 오작동 방지\n        case FONT:\n          if(!saveToggle) {\n            if(text[i - 1] === \"<\") {\n              while(text[i+1] !== \">\") {\n                i++\n              }\n            }\n          } else {\n            content[0]? content[0] += text[i] : content[0] = text[i];\n          }\n\n          break;\n          \n        default:\n          if(saveToggle) {\n            content[0]? content[0] += text[i] : content[0] = text[i];\n          }\n         \n      }\n\n    } else if (propertyToggle){\n\n      switch(text[i]) {\n\n        case \":\":\n          if(property) {\n            type = [convertType(property)]\n            property = null;\n          };\n          break;\n\n        case \";\":\n\n          if(type && property) {\n            type.push(convertProperty(property));\n            if(!type[0]) type.shift();\n            if(type[0] === UNDERBAR) type.pop();\n            propertys.push(type);\n            type = [];\n            property = null;\n          }\n\n          break;\n\n        case \" \":\n\n          if(property && !type[0]) {\n            type = [convertType(property)];\n            propertys.push(type);\n            type = []; \n\n            property = null;\n          }\n\n          break;\n\n        case '\"' || \"'\":\n \n          if(property) {\n            type = [convertType(property)];\n            if(type) {\n              propertys.push(type); \n            }\n          }\n\n          if(!content[1]) {\n            content = [content[0], ];\n            content[1] = [...propertys];\n          } else {\n            content[1] = [...content[1], ...propertys];\n          }\n          propertys = [];\n          propertyToggle = false;\n          property = null;\n          type = [];\n\n          break;\n\n        default: \n          property? property += text[i] : property = text[i];\n      }\n\n    } else if(linkToggle) {\n\n      if(text[i] === \"'\" || text[i] === '\"') {\n        if(!content[1]) {\n          content = [content[0],[[ANCHOR, property]]];\n        } else {\n          content[1].push([ANCHOR, property]);\n        }\n        \n        property = null;\n        linkToggle = false;\n\n      } else {\n        property? property += text[i] : property = text[i];\n      }\n    }\n    \n  }\n\n  if(content[0]) {\n    newContents.push(content);\n  }\n\n  return newContents;\n}\n\nexport function equalsArray(aryA: any[], aryB: any[]): boolean {\n  if(!aryA && !aryB) return true;\n  if(!Array.isArray(aryA) || !Array.isArray(aryB) || aryA.length !== aryB.length ) return false;\n\n  const targetBList = [];\n\n  for(let i = 0; i < aryA.length; i++) {\n    const targetA = JSON.stringify(aryA[i]);\n    if(!i) {\n      for(let ii = 0; ii < aryB.length; ii++) {\n\n        const targetB = JSON.stringify(aryB[ii]);\n        if(targetA === targetB) {\n          \n        } else {\n          targetBList.push(targetB)\n        }\n\n      }\n      if(targetBList.length === aryB.length) return false;\n    } else {\n      const targetBListLength = targetBList.length;\n\n      for(let ii = 0; ii < targetBList.length; ii++) {\n        if(targetBList[ii] === targetA) {\n          targetBList.splice(ii, 1);\n          break;\n        } \n      }\n\n      if(targetBListLength === targetBList.length) {\n        return false;\n      }\n      \n    }\n  } \n\n  return targetBList.length? false : true;\n}\n\nexport function arrayFindIndex(array: any[], factor: any): number {\n  const JSONFactor = JSON.stringify(factor[0]);\n\n  for(let i = 0; i < array.length; i++) {\n    const JSONArray = JSON.stringify(array[i][0]);\n    if(JSONArray === JSONFactor) {\n      return i;\n    }\n  }\n  return -1;\n}\n\n\nfunction addContentsStyle(\n  preTexts: TextContents[], \n  startPoint: number, \n  endPoint: number, \n  style: ContentType\n  ): TextContents[] {\n  let count = 0;\n  let insertText: any = [\"\",[]];\n  let newContents = [];\n\n  preTexts.forEach( (text: any) => {\n\n    for(let i = 0; i < text[0].length; i++) {\n      if(count === startPoint \n        || (count + 1) === endPoint\n        || (count >= startPoint && count < endPoint && i === 0)\n      ) {\n        if(arrayFindIndex(insertText[1], style) === -1) {\n\n          if(insertText[0]) newContents.push(insertText);\n\n          if(text[1]) {\n            if(arrayFindIndex(text[1], style) !== -1) {\n              insertText = [\"\", [...text[1]]];\n            } else {\n              insertText = [\"\", [...text[1], style]];\n            };\n          } else {\n            insertText = [\"\", [style]];\n          };\n\n        } else {\n          \n          if(text[1]) {\n            if(arrayFindIndex(text[1], style) !== -1) {\n\n              if(!equalsArray(insertText[1], text[1])) {\n                newContents.push(insertText);\n                insertText = [\"\", [...text[1]]];\n              };\n\n            } else {\n\n              if(!equalsArray(insertText[1], [...text[1], style])) {\n                newContents.push(insertText);\n                insertText = [\"\", [...text[1], style]];\n              };\n\n            };\n          } else {\n            \n            if(!equalsArray(insertText[1], [style])) {\n              newContents.push(insertText);\n              insertText = [\"\", [style]];\n            };\n\n          };\n        };\n\n      } else if(count === endPoint || i === 0){\n        if(!equalsArray(insertText[1], text[1]? text[1] : [])) { \n          if(insertText[0]) {\n            newContents.push(insertText);\n          }\n          insertText = text[1]?[\"\", [...text[1]]] : [\"\", []];\n        };\n      };\n\n      insertText[0] += text[0][i];\n      count++;\n    }\n    \n  })\n\n  newContents.push(insertText);\n\n  return newContents.map(content => content[1][0]? content : [content[0]]);\n}\n\nfunction deleteContentsStyle(\n  preTexts: TextContents[], \n  startPoint:number, \n  endPoint:number, \n  style: ContentType\n  ): TextContents[] {\n  let count = 0;\n  let insertText:any = [\"\",[]];\n  let newContents = [];\n\n  preTexts.forEach((text: any) => {\n    for(let i = 0; i < text[0].length; i++) {\n\n      if(count === startPoint \n        || (count + 1) === endPoint\n        || (count > startPoint && count < endPoint && i === 0)\n      ) {\n        \n        let stylePosition: number;\n\n        if(text[1]) {\n          if(equalsArray(insertText[1], text[1])) {\n            stylePosition = arrayFindIndex(insertText[1], style);\n\n            if(stylePosition !== -1) {\n              newContents.push(insertText);\n              const newStyle = [...insertText[1]];\n              newStyle.splice(stylePosition, 1);\n              insertText = [\"\", [...newStyle]];\n            } \n\n          } else {\n            const textStylePosition = arrayFindIndex(text[1], style);\n            const newText = [...text[1]];\n            stylePosition = arrayFindIndex(insertText[1], style);\n            \n            if(stylePosition !== -1) {\n              if(insertText[0]) newContents.push(insertText);\n              const newStyle = [...insertText[1]];\n\n              if(textStylePosition !== -1) {\n                newText.splice(textStylePosition, 1);\n                insertText = [\"\", [...newText]];\n              } else {\n                insertText = [\"\", [...text[1]]];\n              }\n\n            } else {\n\n              if(textStylePosition !== -1) {\n                newText.splice(textStylePosition, 1);\n\n                if(!equalsArray(insertText[1], newText)) {\n                  if(insertText[0]) newContents.push(insertText);\n                  insertText = [\"\", [...newText]];\n                }\n\n              } else {\n                if(!equalsArray(insertText[1], text[1])) {\n                  if(insertText[0]) newContents.push(insertText);\n                  insertText = [\"\", [...text[1]]];\n                }\n              }\n              \n            }\n\n\n          }\n        } else if(insertText[1][0]){\n          newContents.push(insertText);\n          insertText = [\"\", []];\n        }\n      } else if(count === endPoint || i === 0) {\n        if(!equalsArray(insertText[1], text[1]? text[1] : [])) { \n          if(insertText[0]) newContents.push(insertText);\n          insertText = text[1]? [\"\", [...text[1]]] : [\"\", []]\n        };\n      }\n      insertText[0] += text[0][i];\n      \n      count++;\n\n    }\n  });\n\n  if(insertText[0]) {\n    newContents.push(insertText);\n  }\n\n  return newContents.map(content => content[1][0]? content : [content[0]]);\n}\n\n\n/**\n * Text contents style 변환 함수\n * return BlockData<TextProps>\n * @param changedTextStyleBlock \n * @param styleType \n * @param startPoint \n * @param endPoint \n * @param order \n */\nfunction changeStyleTextContents(\n  changedTextStyleBlock: BlockData<TextProps>, \n  styleType: ContentType,\n  startPoint: number, \n  endPoint: number,\n  order: OrderType\n):BlockData<TextProps> {\n  \n  let changedTextContents: TextContents[];\n\n  switch(order) {\n    case \"add\":\n      changedTextContents = addContentsStyle(\n        changedTextStyleBlock.property.contents,\n        startPoint,\n        endPoint,\n        styleType\n      );\n      break;\n\n    case \"del\":\n      changedTextContents = deleteContentsStyle(\n        changedTextStyleBlock.property.contents,\n        startPoint,\n        endPoint,\n        styleType\n      );\n      break;\n\n    case \"color\":\n      changedTextContents = addContentsStyle(\n        deleteContentsStyle(\n          changedTextStyleBlock.property.contents,\n          startPoint,\n          endPoint,\n          styleType\n        ),\n        startPoint,\n        endPoint,\n        styleType\n      );\n      break;\n\n    case \"link\":\n      changedTextContents = addContentsStyle(\n        deleteContentsStyle(\n          changedTextStyleBlock.property.contents,\n          startPoint,\n          endPoint,\n          styleType\n        ),\n        startPoint,\n        endPoint,\n        styleType\n      );\n      break;\n\n    default: \n      changedTextContents = changedTextStyleBlock.property.contents;\n  }\n\n  return Object.assign({}, \n    changedTextStyleBlock, {\n      property: Object.assign({}, \n        changedTextStyleBlock.property, {\n          contents: changedTextContents\n      })\n    }\n  );\n}\n\nconst converter = {\n  parseHtmlContents,\n  addContentsStyle,\n  deleteContentsStyle,\n  changeStyleTextContents\n}\n\nexport default converter;","import { RawBlockData, BlockData, UUID } from '../../../../types/bklog';\n\n\ntype Blocks = RawBlockData<any>[] | BlockData<any>[];\n\n/**\n * 첫번째 block 찾기\n */\nconst isFirstBlockPoint = (block: RawBlockData<any> | BlockData<any>) => \n  !block.preBlockId && !block.parentBlockId;\n\n/**\n * 다음 block 찾기\n * @param id \n */\nconst isNextBlockPoint = (id:string) => \n  (block: RawBlockData<any> | BlockData<any>) => \n  block.id === id;\n\n/**\n * block ordering\n * @param block \n */\nexport default function orderingBlock(blocks: Blocks): BlockData<any>[] {\n\n  const rawBlocks: Blocks = blocks.concat();\n  const newBlocks: BlockData<any>[] = [];\n  const deleteCount = 1;\n  const blockLength = blocks.length;\n  \n  let newBlock: BlockData<any> | RawBlockData<any>;\n  let currentPosition: number = 0;\n  let blockIndex: number = 1;\n  let nextBlockId: UUID | null = null;\n  let idStack:UUID[] = [];\n  \n  while(rawBlocks[0] && newBlocks.length < blockLength) {\n    let currentId:UUID | undefined | null;\n\n    if(nextBlockId) {\n      currentId = nextBlockId;\n    } else if(idStack.length >= 1) {\n      currentId = idStack.pop();\n    }\n\n    if(currentId) {\n      currentPosition = rawBlocks.findIndex(isNextBlockPoint(currentId));\n    } else {\n      currentPosition = rawBlocks.findIndex(isFirstBlockPoint);\n    }\n\n    if(currentPosition === -1) {\n      console.log(\"currentId 누락\", currentId, newBlocks)\n      return newBlocks\n    }\n\n    newBlock = rawBlocks[currentPosition];\n\n    if(newBlock.children[0] !== undefined) {\n      nextBlockId = newBlock.children[0];\n        if(newBlock.nextBlockId) idStack.push(newBlock.nextBlockId)\n    } else {\n      nextBlockId = newBlock.nextBlockId;\n    }\n\n    newBlocks.push(Object.assign({}, newBlock, {\n      index: blockIndex++\n    }));\n  \n    rawBlocks.splice(currentPosition, deleteCount);\n  }\n  \n  return newBlocks;\n}","import { v4 as uuidv4 } from 'uuid';\nimport { BlockData, UUID, RawBlockData } from '../../../../types/bklog';\nimport { StagedBlock, parseHtmlContents } from './index';\n\ninterface ChangedData {\n  id: UUID;\n  data: any;\n}\n\ntype Block = BlockData<any> | RawBlockData<any>\n\n/**\n * blockData 생성 함수\n * return blockData<any>\n * @param type \n * @param blockType \n */\nfunction createBlockData(\n  type: string = \"block\", \n  blockType: string = \"bk-p\", \n  preBlockId: UUID | null, \n  nextBlockId?: UUID | null | undefined\n):BlockData<any> {\n  return {\n    index: 0,\n    id: uuidv4(),\n    type: type,\n    parentBlockId: null,\n    preBlockId: preBlockId,\n    nextBlockId: nextBlockId? nextBlockId : null,\n    property: {\n      type: blockType,\n      styles: {\n        color: null,\n        backgroundColor: null\n      },\n      contents: []\n    },\n    children: []\n  }\n}\n\n/**\n * blockData 복사\n * return BlockData<any>\n * @param blockData \n */\nfunction copyBlockData(blockData: BlockData<any>): BlockData<any> {\n  return Object.assign({}, blockData, {\n    id: uuidv4(),\n    parentBlockId: null,\n    preBlockId: null,\n    nextBlockId: null,\n    children: []\n  })\n}\n\nfunction copyBlock(\n  preBlock: BlockData<any> | RawBlockData<any>, \n  preBlockId: UUID | null, \n  parentBlockId?: UUID\n): BlockData<any> {\n  return Object.assign({}, preBlock, {\n    index: 0,\n    id: uuidv4(),\n    preBlockId,\n    parentBlockId: parentBlockId? parentBlockId : null\n  });\n}\n\n/**\n * blockList를 복사하는 함수.\n * @param blockDataList \n */\nfunction copyBlockDataList(\n  blockDataList: Block[]\n): Block[] {\n  let newBlockDataList: Block[] = []; \n  let newPreBlockData: [UUID, number][] = [];\n  let newParentBlockData: [UUID, number][] = [];\n\n  for(let i = 0; i < blockDataList.length; i++) {\n    const newBlock: Block = Object.assign({}, blockDataList[i], {\n      id: uuidv4(),\n      preBlockId: null,\n      nextBlockId: null,\n      parentBlockId: null,\n      children: []\n    });\n\n    if(blockDataList[i].parentBlockId) {\n      const parentData = newParentBlockData[newParentBlockData.length - 1];\n      newBlock.parentBlockId = parentData[0];\n      const children = newBlockDataList[parentData[1]].children;\n      newBlockDataList[parentData[1]].children = insertChild(children,\n        children.length, \n        [newBlock.id]);\n    }\n    \n    if(blockDataList[i].children[0]) {\n      newParentBlockData.push([newBlock.id, i]);\n    }\n\n    if(blockDataList[i].preBlockId && newPreBlockData[0]) {\n      const preBlockData = newPreBlockData.pop();\n      if(preBlockData) {\n        newBlock.preBlockId = preBlockData[0];\n        newBlockDataList[preBlockData[1]].nextBlockId = newBlock.id;\n      }\n    }\n\n    const preNextBlockId = blockDataList[i].nextBlockId;\n    if(preNextBlockId) {\n      if(blockDataList.findIndex(isBlockId(preNextBlockId)) === -1) {\n        newBlock.nextBlockId = null;\n      } else {\n        newPreBlockData.push([newBlock.id, i]);\n      }\n    } else {\n      newParentBlockData.pop();\n    };\n\n    newBlockDataList.push(newBlock);\n  }\n\n  return newBlockDataList;\n}\n\n/**\n * block child 삽입 함수\n * return UUID[]\n * @param children \n * @param insertPoint \n * @param insertChildren \n * @param deleteCount \n */\nfunction insertChild(\n  children: UUID[], \n  insertPoint: number, \n  insertChildren: UUID[], \n  deleteCount: number = 0\n):UUID[] {\n  let newChildren = [...children];\n\n  if(insertChildren) {\n    \n    if(children.length < 1 || children.length === insertPoint) {\n      if(deleteCount && children.length >= 1) {\n        newChildren.pop();\n      }\n      newChildren = newChildren.concat(insertChildren);\n    } else {\n      newChildren.splice(insertPoint, deleteCount, ...insertChildren);\n    }\n\n  } else {\n    newChildren.splice(insertPoint, deleteCount);\n  }\n  return newChildren\n} \n\n/**\n * block id filter 함수\n * @param id \n */\nconst isBlockId = (id: UUID | null) => \n  (block: BlockData | RawBlockData) => \n  block.id === id;\n\n/**\n * blockList를 삽입하는 함수\n * @param preBlocks \n * @param blockDataList \n * @param preBlockId \n */\nfunction insertBlock(\n  preBlocks:Block[],\n  blockDataList: Block[],\n  preBlockId: UUID | null,\n  parentId?: UUID\n): Block[] {\n  let newBlocks: Block[] = preBlocks.map(block => Object.assign({}, block));\n  const newBlockDataList = [...blockDataList];\n  const firstPosition: number = 0;\n\n  let currentBlockId: UUID | null = newBlockDataList[firstPosition].id;\n  let newChildrenList: UUID[] = [];\n\n  const preBlockPosition: number = preBlockId? \n    newBlocks.findIndex(isBlockId(preBlockId)) : -1;\n  const preBlock: Block | null = preBlockId? \n    newBlocks[preBlockPosition] : null;\n  \n  const nextBlockPosition: number = preBlock && preBlock.nextBlockId?\n    newBlocks.findIndex(isBlockId(preBlock.nextBlockId)) : -1;\n  const nextBlock: Block | null = nextBlockPosition !== -1? \n    newBlocks[nextBlockPosition] : null;\n  \n  let parentBlockId: UUID | null = parentId\n    ? parentId \n    : (preBlock && preBlock.parentBlockId? preBlock.parentBlockId : null)\n\n  while(currentBlockId) {\n    const currentBlockPosition: number = newBlockDataList.findIndex(isBlockId(currentBlockId));\n    const currentBlock: Block = newBlockDataList[currentBlockPosition];\n\n    if(currentBlockPosition === firstPosition) {\n      \n      if(preBlock) {\n        newBlockDataList[firstPosition].preBlockId = preBlock.id;\n        newBlocks[preBlockPosition].nextBlockId = currentBlockId;\n      } else {\n        newBlockDataList[firstPosition].preBlockId = null;\n      }\n    }\n  \n    if(parentBlockId) {\n      newBlockDataList[currentBlockPosition].parentBlockId = parentBlockId;\n      newChildrenList.push(currentBlockId);\n    }\n\n    if(!currentBlock.nextBlockId) {\n      if(nextBlock) {\n        newBlockDataList[currentBlockPosition].nextBlockId = nextBlock.id;\n        newBlocks[nextBlockPosition].preBlockId = currentBlockId;\n      }\n      currentBlockId = null;\n    } else {\n      currentBlockId = currentBlock.nextBlockId;\n    }\n\n  }\n\n  if(parentBlockId) {\n    const parentBlockPosition: number = newBlocks.findIndex(isBlockId(parentBlockId));\n    const parentBlock: Block = newBlocks[parentBlockPosition];\n    const insertPosion: number  = preBlockId? \n      parentBlock.children.indexOf(preBlockId) + 1 : 0;\n    const nextBlockPosition: number = !preBlockId? \n      newBlocks.findIndex(isBlockId(parentBlock.children[0])) : -1;\n\n    if(nextBlockPosition !== -1) {\n      const newBlockLastChild: UUID = newChildrenList[newChildrenList.length - 1];\n      const newBlocklastChildPosition: number = newBlockDataList.findIndex(isBlockId(newBlockLastChild));\n      newBlocks[nextBlockPosition].preBlockId = newBlockLastChild;\n      newBlockDataList[newBlocklastChildPosition].nextBlockId = newBlocks[nextBlockPosition].id;\n    }\n\n    newBlocks[parentBlockPosition].children = insertChild(\n      parentBlock.children, \n      insertPosion,\n      newChildrenList  \n    );\n  }\n\n  newBlocks = newBlocks.concat(newBlockDataList);\n\n  return newBlocks;\n}\n\n/**\n * \n * @param blockDatas \n * @param stagedBlock \n */\nfunction updateContents(\n  blockData:BlockData<any>[], \n  stageData: StagedBlock[]\n):BlockData<any>[] {\n\n  let newBlocks = blockData.map(block => Object.assign({}, block));\n\n  stageData.forEach((block)=>{\n\n    if(newBlocks[block.blockIndex - 1] && block.id === newBlocks[block.blockIndex - 1].id) {\n      \n      if(newBlocks[block.blockIndex - 1].type === \"text\") {\n        newBlocks[block.blockIndex - 1].property = Object.assign({}, \n          newBlocks[block.blockIndex - 1].property, {\n            contents: typeof block.contents === \"string\"? \n                      parseHtmlContents(block.contents) : block.contents\n        });\n      }\n      \n    } else {\n      console.log(\"block이 제대로 정렬되지 않았습니다.\");\n    }\n\n  });\n  \n  return newBlocks;\n}\n\nconst isNotBlockId = (id: UUID) => \n  (block:BlockData<any>) => block.id !== id;\n/**\n * block 제외 함수\n * @param blocks \n * @param id \n */\nfunction excludeBlock(blocks: BlockData<any>[], id: UUID): BlockData<any>[] {\n  const deletedId = id;\n  const deletedBlock = blocks.filter(isBlockId(deletedId))[0];\n  const preBlockId = deletedBlock.preBlockId;\n  const nextBlockId = deletedBlock.nextBlockId;\n  const parentBlockId = deletedBlock.parentBlockId;\n\n  if((!preBlockId && !parentBlockId) || deletedBlock.type === \"title\") {\n    console.log(\"title은 삭제할 수 없습니다.\")\n    return blocks\n  } \n\n  let deletedBlocks = blocks.filter(isNotBlockId(deletedId));\n\n  let newPreBlockId = preBlockId;\n  let newNextBlockId = nextBlockId;\n\n\n  if(deletedBlock.children[0]) {\n    let childPositionList:number[] = [];\n    deletedBlock.children.forEach(child => {\n      childPositionList.push(deletedBlocks.findIndex(isBlockId(child)));\n    })\n    const firstChild = childPositionList[0];\n    const lastChild = childPositionList[childPositionList.length -1];\n    if(preBlockId) {\n      deletedBlocks[firstChild].preBlockId = preBlockId;\n      newNextBlockId = deletedBlocks[firstChild].id;\n    }\n      \n    if(nextBlockId) {\n      deletedBlocks[lastChild].nextBlockId = nextBlockId;\n      newPreBlockId = deletedBlocks[lastChild].id;\n    }\n    \n    childPositionList.forEach((child)=>{\n      deletedBlocks[child].parentBlockId = parentBlockId;\n    });\n  } \n\n  if(parentBlockId) {\n    const parentBlockPosition = deletedBlocks.findIndex(isBlockId(parentBlockId));\n    const parentBlock = deletedBlocks[parentBlockPosition];\n    const deletePosition = parentBlock.children.indexOf(deletedId);\n\n    deletedBlocks[parentBlockPosition] = Object.assign({}, parentBlock, {\n      children: deletedBlock.children[0] ?\n      insertChild(parentBlock.children, deletePosition, deletedBlock.children, 1)\n      : parentBlock.children.filter((child) => child !== deletedId)\n    })\n  }\n\n  if(preBlockId) {\n    const preBlockPosition = deletedBlocks.findIndex(isBlockId(preBlockId));\n    deletedBlocks[preBlockPosition].nextBlockId = newNextBlockId;\n  }\n\n  if(nextBlockId) {\n    const nextBlockPosition = deletedBlocks.findIndex(isBlockId(nextBlockId));\n    deletedBlocks[nextBlockPosition].preBlockId = newPreBlockId;\n  }\n\n  console.log(\"deletedBlocks\",deletedBlocks, deletedId, deletedBlock, blocks);\n  return deletedBlocks;\n}\n\n/**\n * \n * @param blocks \n * @param blockIdList 지워질 blockList들은 서로 연결이 되어 있어야 함.\n */\nfunction excludeBlockList(blocks: BlockData<any>[], blockIdList: UUID[]) {\n\n  let deletedBlocks: BlockData<any>[] = blocks.map((block) => Object.assign({}, block));\n  let currentBlockId: UUID | null = blockIdList[0];\n\n  let preBlockData: [UUID, number] | null = null;\n  let nextBlockData: [UUID, number] | null = null;\n\n  while(currentBlockId) {\n    const currentBlock: BlockData<any> = blocks.filter(isBlockId(currentBlockId))[0];\n\n    let preBlockId = currentBlock.preBlockId;\n    let nextBlockId = currentBlock.nextBlockId;\n    let parentBlockId = currentBlock.parentBlockId;\n\n    if((!preBlockId && !parentBlockId) || currentBlock.type === \"title\") {\n      console.log(\"title은 삭제할 수 없습니다.\")\n      return blocks\n    } \n\n    if(parentBlockId) {\n      const parentPosition = deletedBlocks.findIndex(isBlockId(parentBlockId));\n\n      deletedBlocks[parentPosition].children = deletedBlocks[parentPosition].children.filter((child)=>\n        child !== currentBlock.id\n      );\n    }\n    \n    if(preBlockId) {\n      const findCheck = blockIdList.find((id)=> id === preBlockId);\n      if(!findCheck) {\n        const preBlockPosition = deletedBlocks.findIndex(isBlockId(preBlockId));\n        preBlockData = [preBlockId, preBlockPosition];\n      }\n    }\n\n    if(nextBlockId) {\n      const findCheck = blockIdList.find((id)=> id === nextBlockId);\n      if(!findCheck) {\n        const nextBlockPosition = deletedBlocks.findIndex(isBlockId(nextBlockId));\n        nextBlockData = [nextBlockId, nextBlockPosition];\n\n        currentBlockId = null;\n      } else {\n        currentBlockId = nextBlockId;\n      }\n    } else {\n      currentBlockId = null;\n    }\n\n  }\n\n  if(preBlockData && nextBlockData) {\n    deletedBlocks[preBlockData[1]].nextBlockId = nextBlockData[0];\n    deletedBlocks[nextBlockData[1]].preBlockId = preBlockData[0];\n  } else if(preBlockData) {\n    deletedBlocks[preBlockData[1]].nextBlockId = null;\n  } else if(nextBlockData) {\n    deletedBlocks[nextBlockData[1]].preBlockId = null;\n  } \n\n  for(let i = 0; i < blockIdList.length; i++) {\n    deletedBlocks = deletedBlocks.filter(isNotBlockId(blockIdList[i]));\n  }\n\n  return deletedBlocks;\n}\n\n// 되돌아가기를 했을때 그 전 preBlockId를 기억하고 있으면 될 것 같음.\n/**\n * block의 위치를 바꾸는 함수\n * @param preBlocks \n * @param blockId \n * @param preBlockId \n */\nfunction switchingBlock(\n  preBlocks:BlockData<any>[],\n  blockId: UUID,\n  preBlockId: UUID | null,\n  parentId?: UUID\n): Block[] {\n  let newBlocks: BlockData<any>[] = preBlocks.filter(isNotBlockId(blockId));\n  const currentBlock = preBlocks.filter(isBlockId(blockId))[0];\n\n  if(currentBlock.preBlockId) {\n    const preBlockPosition = newBlocks.findIndex(isBlockId(currentBlock.preBlockId));\n    const preBlockId = newBlocks[preBlockPosition].id;\n    if(currentBlock.nextBlockId) {\n      const nextBlockPosition = newBlocks.findIndex(isBlockId(currentBlock.nextBlockId));\n      const nextBlockId = newBlocks[nextBlockPosition].id;\n      newBlocks[nextBlockPosition].preBlockId = preBlockId;\n      newBlocks[preBlockPosition].nextBlockId = nextBlockId;\n    } else {\n      newBlocks[preBlockPosition].nextBlockId = null;\n    }\n  }\n\n  if(currentBlock.parentBlockId) {\n    const parentBlockPosition = newBlocks.findIndex(isBlockId(currentBlock.parentBlockId));\n    newBlocks[parentBlockPosition].children = newBlocks[parentBlockPosition].children.filter(child => \n      child !== currentBlock.id);\n\n    currentBlock.parentBlockId = null;\n  }\n\n  const preBlockPosition = preBlockId? newBlocks.findIndex(isBlockId(preBlockId)) : -1;\n  const preBlock = parentId? newBlocks[preBlockPosition] : null;\n\n  const parentBlockId = parentId? parentId : (preBlock? preBlock.parentBlockId : null);\n  \n  let nextBlockPosition = preBlock && preBlock.nextBlockId?\n    newBlocks.findIndex(isBlockId(preBlock.nextBlockId)) : -1;\n  let nextBlock = nextBlockPosition !== -1? \n    newBlocks[nextBlockPosition] : null;\n\n  currentBlock.preBlockId = preBlock? preBlock.id : null;\n\n  if(preBlock) {\n    newBlocks[preBlockPosition].nextBlockId = currentBlock.id;\n  }\n\n  if(parentBlockId) {\n    const parentBlockPosition = newBlocks.findIndex(isBlockId(parentBlockId));\n    const parentBlock = newBlocks[parentBlockPosition];\n    const insertPosion = preBlock && preBlock.parentBlockId? \n      (parentBlock.children.indexOf(preBlock.id) + 1) : 0;\n\n    if(parentBlock.children[0]) {\n      const lastChild = parentBlock.children[parentBlock.children.length - 1];\n      nextBlockPosition = newBlocks.findIndex(isBlockId(lastChild));\n      nextBlock = newBlocks[nextBlockPosition];\n    }\n\n    currentBlock.parentBlockId = parentBlock.id;  \n\n    newBlocks[parentBlockPosition].children = insertChild(\n      parentBlock.children, \n      insertPosion,\n      [currentBlock.id]  \n    );\n  }\n\n  if(nextBlock) {\n    currentBlock.nextBlockId = nextBlock.id;\n    newBlocks[nextBlockPosition].preBlockId = currentBlock.id;\n  } else {\n    currentBlock.nextBlockId = null;\n  }\n\n  newBlocks.push(currentBlock)\n\n  return newBlocks;\n}\n\n/**\n * block 복구\n * @param preBlocks \n * @param blockData \n */\nfunction restoreBlock(\n  preBlocks: BlockData<any>[],\n  blockData: BlockData<any>\n) {\n  \n  const changedData:ChangedData[] = []; \n\n  const currentBlock = Object.assign({}, blockData);\n  changedData.push({\n    id: currentBlock.id,\n    data: [blockData]\n  });\n\n  const newBlocks = preBlocks.map(block => Object.assign({}, block));\n\n  if(currentBlock.preBlockId) {\n    const preBlockPosition = newBlocks.findIndex(isBlockId(currentBlock.preBlockId));\n\n    newBlocks[preBlockPosition].nextBlockId = currentBlock.id;\n    changedData.push({\n      id: newBlocks[preBlockPosition].id,\n      data: [{\n        nextBlockId: newBlocks[preBlockPosition].nextBlockId\n      }]\n    });\n  }\n\n  if(currentBlock.nextBlockId) {\n    const nextBlockPosition = newBlocks.findIndex(isBlockId(currentBlock.nextBlockId));\n\n    newBlocks[nextBlockPosition].preBlockId = currentBlock.id;\n    changedData.push({\n      id: newBlocks[nextBlockPosition].id,\n      data: [{\n        preBlockId: newBlocks[nextBlockPosition].preBlockId\n      }]\n    });\n  }\n  \n  if(currentBlock.parentBlockId) {\n    const parentBlockPosition = newBlocks.findIndex(isBlockId(currentBlock.parentBlockId));\n    let insertPoint: number = 0;\n    if(currentBlock.preBlockId) {\n      insertPoint = newBlocks[parentBlockPosition].children.findIndex(child => \n        child === currentBlock.preBlockId ) + 1;\n    }\n\n    newBlocks[parentBlockPosition].children = insertChild(\n      newBlocks[parentBlockPosition].children,\n      insertPoint,\n      [currentBlock.id]\n    );\n    changedData.push({\n      id: newBlocks[parentBlockPosition].id,\n      data: [{\n        children: newBlocks[parentBlockPosition].children\n      }]\n    });\n  }\n\n  if(currentBlock.children[0]) {\n\n    for(let i = 0; i < currentBlock.children.length; i++) {\n\n      const childId = currentBlock.children[i];\n      const childPosition = newBlocks.findIndex(isBlockId(childId));\n      const childChangedData: any = [];\n\n      if(i === 0) {\n        newBlocks[childPosition].preBlockId = null;\n        childChangedData.push({\n          preBlockId: null\n        });\n      }\n\n      if(i === currentBlock.children.length -1) {\n        newBlocks[childPosition].nextBlockId = null;\n        childChangedData.push({\n          nextBlockId: null\n        });\n      }\n\n      const preParentBlockId = newBlocks[childPosition].parentBlockId;\n      if(preParentBlockId) {\n        const preParentPosition = newBlocks.findIndex(isBlockId(preParentBlockId));\n        newBlocks[preParentPosition].children = newBlocks[preParentPosition].children.filter(child => \n          child !== childId\n        );\n\n        if(childPosition === currentBlock.children.length -1) {\n          changedData.push({\n            id: preParentBlockId,\n            data: [\n              {\n                children: newBlocks[preParentPosition].children\n              }\n            ]\n          }); \n        }\n\n      }\n\n      newBlocks[childPosition].parentBlockId = currentBlock.id;\n      childChangedData.push({\n        parentBlockId: currentBlock.id\n      })\n\n      changedData.push({\n        id: newBlocks[childPosition].id,\n        data: [...childChangedData]\n      });\n\n    }\n    \n  }\n\n  newBlocks.push(currentBlock);\n\n  return {\n    blocks: newBlocks,\n    changedData\n  };\n}\n\nconst blocksUtils = {\n  createBlockData,\n  copyBlockData,\n  copyBlockDataList,\n  insertBlock,\n  insertChild,\n  updateContents,\n  excludeBlock,\n  excludeBlockList,\n  switchingBlock,\n  restoreBlock\n}\n\nexport default blocksUtils;","import { TempData, StagedBlock } from './index';\nimport { BlockData, TextProps } from '../../../../types/bklog';\n\nfunction tempDataPush(\n  tempStore: TempData[], \n  tempData: TempData, \n  limitCount: number = 5\n  ): TempData[] {\n\n  const newTempStore = [...tempStore, tempData];\n  if(limitCount < newTempStore.length) {\n    newTempStore.shift();\n  }\n\n  return newTempStore;\n}\n\nfunction getContentsToBeChanged(\n  blocks: BlockData<any>[], \n  stage: StagedBlock[]\n  ): StagedBlock[] {\n  \n  let changedBlocks:BlockData<TextProps>[] = [];\n\n  stage.forEach(data => {\n    if(blocks[data.blockIndex - 1].type === \"text\") {\n      changedBlocks.push(blocks[data.blockIndex - 1]);\n    }\n  });\n  \n  console.log(changedBlocks);\n  return changedBlocks.map(block => {\n    return {\n      id: block.id,\n      contents: block.property? block.property.contents : null,\n      blockIndex: block.index\n    }\n  })\n}\n\nconst tempStoreUtils = {\n  tempDataPush,\n  getContentsToBeChanged\n}\n\nexport default tempStoreUtils;","import {\n  BlockData,\n  UUID\n} from '../../../../types/bklog';\nimport converter from './converter';\nimport * as ordering  from './ordering';\nimport blocksUtils from './blocksUtils';\nimport tempStoreUtils from './tempStoreUtils';\n\n/**\n * types\n */\nexport interface EditedBlock {\n  blockId: UUID;\n  blockIndex: number;\n  text: string;\n}\nexport interface StagedBlock{\n  id: UUID;\n  contents: any;\n  blockIndex: number;\n}\nexport interface TempData {\n  type: string;\n  data: any;\n}\nexport interface BklogState {\n  pageId: UUID;\n  userId: string;\n  editingId: string | null;\n  blocks: BlockData<any>[];\n  stage: StagedBlock[];\n  rightToEdit: boolean;\n  tempBack: TempData[];\n  tempFront: TempData[];\n}\nexport type OrderType = \"add\" | \"del\" | \"color\" | \"link\";\n\n/**\n * action Type\n */\nexport const ADD_BLOCK    = 'bklog/ADD_BLOCK' as const;\nexport const EDITABLE     = 'bklog/EDITABLE' as const; \nexport const EDIT_BLOCK   = 'bklog/EDIT_BLOCK' as const; // 임시 데이터로 이동\nexport const COMMIT_BLOCK = 'bklog/COMMIT_BLOCK' as const;\nexport const DELETE_BLOCK = 'bklog/DELETE_BLOCK' as const;\nexport const UPDATE_BLOCK = 'bklog/UPDATE_BLOCK' as const; // DB에 업데이트할 때\nexport const SWITCH_BLOCK = 'bklog/SWITCH_BLOCK' as const;\nexport const REVERT_BLOCK = 'bklog/REVERT_BLOKC' as const;\nexport const CHANGE_TEXT_STYLE = 'bklog/CHANGE_TEXT_STYLE' as const;\n\n/**\n * converter\n */\nexport const parseHtmlContents       = converter.parseHtmlContents;\nexport const addContentsStyle        = converter.addContentsStyle;\nexport const deleteContentsStyle     = converter.deleteContentsStyle;\nexport const changeStyleTextContents = converter.changeStyleTextContents;\n\n/**\n * ordering\n */\nexport const orderingBlock = ordering.default;\n\n/**\n * blocksUtils\n */\nexport const createBlockData   = blocksUtils.createBlockData;\nexport const copyBlockData     = blocksUtils.copyBlockData;\nexport const copyBlockDataList = blocksUtils.copyBlockDataList;\nexport const insertBlock       = blocksUtils.insertBlock;\nexport const insertChild       = blocksUtils.insertChild;\nexport const updateContents    = blocksUtils.updateContents;\nexport const excludeBlock      = blocksUtils.excludeBlock;\nexport const excludeBlockList  = blocksUtils.excludeBlockList;\nexport const switchingBlock    = blocksUtils.switchingBlock;\nexport const restoreBlock      = blocksUtils.restoreBlock;\n\n/**\n * tempStoreUtils\n */\nexport const tempDataPush           = tempStoreUtils.tempDataPush;\nexport const getContentsToBeChanged = tempStoreUtils.getContentsToBeChanged;","import {\n  ContentType,\n  BlockData,\n  UUID\n} from '../../../types/bklog';\n\nimport { \n  ADD_BLOCK,\n  EDITABLE,\n  EDIT_BLOCK,\n  COMMIT_BLOCK,\n  DELETE_BLOCK,\n  UPDATE_BLOCK,\n  SWITCH_BLOCK,\n  REVERT_BLOCK,\n  CHANGE_TEXT_STYLE,\n  EditedBlock,\n  BklogState,\n  OrderType,\n  orderingBlock,\n  createBlockData,\n  copyBlockData,\n  insertBlock,\n  tempDataPush,\n  updateContents,\n  changeStyleTextContents,\n  excludeBlock,\n  excludeBlockList,\n  switchingBlock,\n  restoreBlock,\n  getContentsToBeChanged\n} from './utils';\n\nimport { page } from '../../../data/db.json';\n\nimport { newDataList } from '../../../index.test';\n\n/**\n * BlockLog store\n */\nexport function addBlock(blockId?: UUID, type?: string, block?: BlockData<any>) {\n  return {\n    type: ADD_BLOCK,\n    payload: {\n      preBlockId: blockId,\n      newBlockType: type,\n      blockData: block\n    }\n  }\n}\n\nexport function editAble (id: UUID | null, index?: number) {\n  return {\n    type: EDITABLE,\n    payload: {\n      editingId: id,\n      editingIndex: index\n    }\n  }\n}\n\nexport function editBlock({ \n  blockId,\n  blockIndex,\n  text,\n}: EditedBlock) {\n  return {\n    type: EDIT_BLOCK,\n    payload: {\n      blockId,\n      blockIndex,\n      text\n    }\n  }\n}\n\nexport function commitBlock() {\n  return {\n    type: COMMIT_BLOCK\n  }\n}\n\nexport function deleteBlock(deletedId: UUID) {\n  return {\n    type: DELETE_BLOCK,\n    payload: {\n      deletedId\n    }\n  }\n}\n\nexport function updateBlock(id: UUID) {\n  return {\n    type: UPDATE_BLOCK,\n    payload: {\n      id\n    }\n  }\n}\n\nexport function changeTextStyle(\n  index: number, \n  style: ContentType, \n  startPoint: number,\n  endPoint: number,\n  order: OrderType\n  ) {\n  return {\n    type: CHANGE_TEXT_STYLE,\n    payload: {\n      changedTextStyleBlockIndex: index,\n      styleType: style,\n      startPoint,\n      endPoint,\n      order\n    }\n  }\n}\n\nexport function revertBlock() {\n  return {\n    type: REVERT_BLOCK\n  }\n}\n\nexport function switchBlock(blockId: UUID, preBlockId: UUID) {\n  return {\n    type: SWITCH_BLOCK,\n    payload: {\n      switchedId: blockId,\n      positionId: preBlockId\n    }\n  }\n}\n\nexport type BklogActions = ReturnType<typeof addBlock>\n  | ReturnType<typeof editAble>\n  | ReturnType<typeof editBlock>\n  | ReturnType<typeof commitBlock>\n  | ReturnType<typeof deleteBlock>\n  | ReturnType<typeof updateBlock>\n  | ReturnType<typeof changeTextStyle>\n  | ReturnType<typeof revertBlock>\n  | ReturnType<typeof switchBlock>\n;\n\nconst initialState:BklogState = (() => {\n  return {\n    pageId: page.id,\n    userId: page.userId,\n    blocks: orderingBlock(page.blocks),\n    editingId: null,\n    stage: [],\n    rightToEdit: true,\n    tempBack: [],\n    tempFront: []\n  };\n})();\n\nfunction bklog(state: BklogState = initialState, action: BklogActions):BklogState {\n\n  switch(action.type) {\n\n    case ADD_BLOCK:\n      const { preBlockId, newBlockType, blockData } = action.payload;\n\n      const preBlock = preBlockId? \n        state.blocks.filter(block => block.id === preBlockId)[0] \n        : state.blocks[state.blocks.length - 1];\n\n      const newBlock: BlockData<any> = blockData? \n        copyBlockData(blockData) \n        : createBlockData(\"block\", newBlockType, preBlock.id);\n      \n      console.log(newBlock);\n\n      const addedBlocks = insertBlock(state.blocks, [newBlock], preBlock.id);\n\n      return Object.assign({}, state, {\n        blocks: orderingBlock(addedBlocks),\n        editingId: newBlock.id,\n        tempBack: tempDataPush(state.tempBack,{\n          type: ADD_BLOCK,\n          data: {\n            id: newBlock.id\n          }\n        })\n      }) \n\n    case EDITABLE: \n      const { editingId, editingIndex } = action.payload\n      \n      let editingBlockId: UUID | null;\n      \n      if(editingIndex) {\n        if(editingIndex >= 1 && editingIndex <= state.blocks.length) {\n          editingBlockId = state.blocks[editingIndex - 1].id;\n        } else {\n          editingBlockId = null\n        }\n      } else {\n        editingBlockId = editingId\n      }\n\n      return Object.assign({}, state, {\n        editingId: editingBlockId\n      })\n    \n    case EDIT_BLOCK: \n      const editedId = action.payload.blockId;\n      const text = action.payload.text;\n      const editedBlockIndex = action.payload.blockIndex;\n\n      const preStagedBlock = state.stage.filter(stagedBlock => \n          stagedBlock.id !== editedId\n        );\n\n      const newStagedBlock = {\n        id: editedId,\n        blockIndex: editedBlockIndex,\n        contents: text\n      }\n\n      return Object.assign({}, state, {\n        stage: preStagedBlock? [...preStagedBlock, newStagedBlock] : [newStagedBlock]\n      })\n\n    case CHANGE_TEXT_STYLE:\n      const { \n        changedTextStyleBlockIndex, \n        styleType, \n        startPoint, \n        endPoint,\n        order\n       } = action.payload;\n       \n      const changedTextStyleBlock = state.blocks[changedTextStyleBlockIndex -1];\n      if( changedTextStyleBlock.type !== \"text\") {\n        console.log(\"text block이 아닙니다.\")\n        return state;\n      }\n\n      const newTempData = {\n        id: changedTextStyleBlock.id,\n        contents: changedTextStyleBlock.property.contents,\n        blockIndex: changedTextStyleBlock.index\n      }\n      \n      return Object.assign({}, state, {\n        blocks: state.blocks.map((block)=> \n          block.index === changedTextStyleBlockIndex? \n          changeStyleTextContents(\n            changedTextStyleBlock, \n            styleType, \n            startPoint, \n            endPoint,\n            order\n          )\n          : block  \n        ),\n        tempBack: tempDataPush(state.tempBack, {\n          type: CHANGE_TEXT_STYLE,\n          data: [newTempData]\n        })\n      })\n      \n      \n    case COMMIT_BLOCK: \n      if(!state.stage[0]) return state;\n\n      const newTempBack = getContentsToBeChanged(state.blocks, state.stage);\n      \n      const newState = Object.assign({}, state, {\n        blocks: updateContents(state.blocks, state.stage),\n        stage: [],\n        editingId: null,\n        tempBack: tempDataPush(state.tempBack, {\n          type: COMMIT_BLOCK,\n          data: newTempBack\n        })\n      });\n\n      localStorage.setItem(\"bklog\", JSON.stringify(newState));\n\n      return newState;\n\n\n    case DELETE_BLOCK: \n      const { deletedId } = action.payload;\n      \n      if(deletedId === state.blocks[0].id) return state;\n\n      const deletedBlock = state.blocks.filter((block)=>\n        block.id === deletedId\n      )[0];\n\n      return Object.assign({}, state, {\n        blocks: orderingBlock(excludeBlock(state.blocks, deletedId)),\n        tempBack: tempDataPush(state.tempBack, {\n          type: DELETE_BLOCK,\n          data: deletedBlock\n        })\n      });\n    \n    case SWITCH_BLOCK:\n      const { switchedId, positionId } = action.payload;\n      const switchedBlocks = switchingBlock(state.blocks, switchedId, positionId);\n      console.log(switchedBlocks);\n\n      return Object.assign({}, state, {\n        blocks: orderingBlock(switchedBlocks)\n      });\n    \n    case REVERT_BLOCK:  \n      const testBlock = state.tempBack.pop();\n      let restoreBlocks;\n\n      if(testBlock && testBlock.data.id) {\n        restoreBlocks = restoreBlock(state.blocks, testBlock.data);\n      } \n\n      console.log(restoreBlocks);\n\n      return restoreBlocks? Object.assign({}, state, {\n        blocks: orderingBlock(restoreBlocks.blocks)\n      }) : state\n      \n    default: \n      // let preState = localStorage.getItem(\"bklog\")\n      console.log(\"state:\", state);\n      return state;\n  }\n\n}\n\nexport default bklog;","import { useCallback, useMemo } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { RootState } from '../store/modules';\nimport {\n  addBlock, \n  editAble,\n  editBlock,\n  commitBlock,\n  deleteBlock,\n  changeTextStyle,\n  switchBlock,\n  revertBlock\n} from '../store/modules/bklog';\nimport { BklogState, OrderType } from '../store/modules/bklog/utils';\nimport {\n  UUID,\n  ContentType,\n  BlockData\n} from '../types/bklog';\n\nfunction useBklog() {\n  \n  const state:BklogState = useSelector((state: RootState) => state.bklog);\n\n  const initBlock: BlockData<any>[] = useMemo(()=> \n    state.blocks.filter(block => block.parentBlockId === null), [state.blocks]);\n\n  const getEditAbleId = useMemo(() => state.editingId, [state.editingId]);\n\n  const getStagedBlocks = state.stage;\n\n  const getChilrenBlock = (blockId: UUID):BlockData<any>[] => \n    state.blocks.filter(block => block.parentBlockId === blockId); \n\n  const getBlockState = (blockId: UUID): BlockData<any>  => \n    state.blocks.filter(blockState => blockState.id === blockId)[0];\n  \n  const getStagedBlock = (blockId: UUID) =>\n    state.stage.filter(statedBlock => statedBlock.id === blockId)[0];\n\n  const getRigthToEdit = useMemo(() => state.rightToEdit,[]);\n  \n  const dispatch = useDispatch();\n\n  // Block 추가\n  const onAddBlock = useCallback((\n      blockId?: UUID, \n      type?: string, \n      blockData?: BlockData<any>\n    ) => dispatch(addBlock(blockId, type, blockData)), [dispatch]);\n\n  // edit중인 block focus\n  const onEditAble = useCallback((blockId: UUID | null, index?:number) =>\n      dispatch(editAble(blockId, index))\n    ,[dispatch]);\n\n  const onEditBlock = useCallback((blockId: UUID, blockIndex: number,content: string) =>\n      dispatch(editBlock({blockId, blockIndex, text: content}))\n    ,[dispatch]);\n\n  const onCommitBlock = useCallback(()=>\n      dispatch(commitBlock())\n    ,[dispatch]);\n\n  const onDeleteBlock = useCallback((blockId: UUID) =>\n      dispatch(deleteBlock(blockId))\n    , [dispatch]);\n\n  const onChangeTextStyle = useCallback((\n    index: number, \n    style: ContentType,\n    startPoint: number,\n    endPoint: number,\n    order: OrderType\n    ) => \n      dispatch(changeTextStyle(index, style, startPoint, endPoint, order))\n    , [dispatch]);\n  \n  const onSwitchBlock = useCallback((blockId: UUID, preBlockId: UUID) => \n    dispatch(switchBlock(blockId, preBlockId)), [dispatch]);\n\n  const onRevertBlock = useCallback(()=> \n      dispatch(revertBlock()), [dispatch]);\n\n  return { \n    state, \n    initBlock,\n    getRigthToEdit,\n    getChilrenBlock,\n    getBlockState,\n    getStagedBlocks,\n    getStagedBlock,\n    getEditAbleId, \n    onAddBlock, \n    onEditAble, \n    onEditBlock, \n    onCommitBlock, \n    onDeleteBlock,\n    onChangeTextStyle,\n    onSwitchBlock,\n    onRevertBlock\n  };\n}\n\nexport default useBklog;","import { TextContents, ContentType } from '../../../types/bklog';\nimport { \n  equalsArray, \n} from '../../../store/modules/bklog/utils/converter';\n\nconst BOLD = \"b\" as const;\nconst ITALY = \"i\" as const;\nconst UNDERBAR = \"_\" as const;\nconst FONT_COLOR = \"fc\" as const;\nconst BACKGROUND_COLOR = \"bc\" as const;\nconst ANCHOR = \"a\" as const;\nconst FONT_WEIGHT_BOLD  = \"font-weight: 700;\" as const;\nconst FONT_STYLE_ITALIC = \"font-style: italic;\" as const;\nconst BORDER_BOTTOM     = \"border-bottom: 0.05em solid;\" as const;\nconst COLOR             = \"color:\" as const;\nconst BACKGROUND_C      = \"background-color:\" as const;\n\nexport const arrayUtils = { equalsArray };\n\nexport function contentsElement(rawContents: any) {\n  let text;\n  let className:string | null = null;\n  let styles:string | null = null;\n  let aTag;\n\n  if(rawContents.length === 2) {\n    rawContents[1].forEach((content:string[]) => {\n      switch(content[0]) {\n\n        case BOLD:\n          styles = styles? styles + ` ${FONT_WEIGHT_BOLD}` : FONT_WEIGHT_BOLD;\n          break;\n\n        case ITALY:\n          styles = styles? styles + ` ${FONT_STYLE_ITALIC}` : FONT_STYLE_ITALIC;\n          break;\n\n        case UNDERBAR:\n          styles = styles? styles + ` ${BORDER_BOTTOM}` : BORDER_BOTTOM;\n          break;\n\n        case FONT_COLOR:\n          styles = styles? styles + ` ${COLOR} ${content[1]};` : `${COLOR} ${content[1]};`;\n          break;\n\n        case BACKGROUND_COLOR:\n          styles = styles? styles + ` ${BACKGROUND_C} ${content[1]};` : `${BACKGROUND_C} ${content[1]};`;\n          break;\n          \n        case ANCHOR:\n          aTag = content[1];\n      }\n    })\n    text = `<span${className? ' class=\"'+ className + '\"' : \"\"}${styles? ' style=\"' + styles + '\"' : \"\"}>${rawContents[0]}</span>`\n\n    if(aTag) {\n      let preText = text;\n      text = `<a href=\"${aTag}\">${preText}</a>`;\n    }\n  } else {\n    text = rawContents[0];\n  }\n\n  return text;\n}\n\nexport function createContentsElement(accumulator: string, rawContents: any, currentIndex: number):string {\n  return currentIndex === 1?  contentsElement(accumulator) + contentsElement(rawContents) : accumulator + contentsElement(rawContents);\n}\n\nexport function findTextStyle(\n  textContents: TextContents[], \n  position: number\n  ): ContentType[] | null | undefined {\n\n  let count: number = 0;\n  let style: ContentType[] | null | undefined = null;\n\n  for(let i = 0; i < textContents.length; i++) {\n    count += textContents[i][0].length;\n\n    if(count > position) {\n      style = textContents[i].length === 2? textContents[i][1] : null;\n      break;\n    } \n\n  }\n\n  return style;\n}\n\nexport function arrayFindIndex(array: any[], factor: any): number {\n  const JSONFactor = JSON.stringify(factor);\n\n  for(let i = 0; i < array.length; i++) {\n    const JSONArray = JSON.stringify(array[i]);\n    if(JSONArray === JSONFactor) {\n      return i;\n    }\n  }\n  return -1;\n}","// Usage:\n// let x = document.querySelector('[contenteditable]');\n// let caretPosition = getSelectionDirection(x) !== 'forward' ? getSelectionStart(x) : getSelectionEnd(x);\n// setSelectionRange(x, caretPosition + 1, caretPosition + 1);\n// let value = getValue(x);\n\n// it will not work with \"<img /><img />\" and, perhaps, in many other cases.\n\nexport function isAfter(container:any, offset:any, node:any):any {\n  let c = node;\n  while (c.parentNode !== container) {\n    c = c.parentNode;\n  }\n  let i = offset;\n  while (c !== null && i > 0) {\n    c = c.previousSibling;\n    i -= 1;\n  }\n  return i > 0;\n}\n\nexport function compareCaretPositons(node1: any, offset1: any, node2: any, offset2: any): any {\n  if (node1 === node2) {\n    return offset1 - offset2;\n  }\n  let c = node1.compareDocumentPosition(node2);\n  if ((c & Node.DOCUMENT_POSITION_CONTAINED_BY) !== 0) {\n    return isAfter(node1, offset1, node2) ? +1 : -1;\n  } else if ((c & Node.DOCUMENT_POSITION_CONTAINS) !== 0) {\n    return isAfter(node2, offset2, node1) ? -1 : +1;\n  } else if ((c & Node.DOCUMENT_POSITION_FOLLOWING) !== 0) {\n    return -1;\n  } else if ((c & Node.DOCUMENT_POSITION_PRECEDING) !== 0) {\n    return +1;\n  }\n}\n\nexport function stringifyElementStart(node: any, isLineStart: any): any {\n  if (node.tagName.toLowerCase() === 'br') {\n    if (true) {\n      return '\\n';\n    }\n  }\n  if (node.tagName.toLowerCase() === 'div') { // Is a block-level element?\n    if (!isLineStart) { //TODO: Is not at start of a line?\n      return '\\n';\n    }\n  }\n  return '';\n}\n\nexport function* positions(node:any, isLineStart = true):any {\n  console.assert(node.nodeType === Node.ELEMENT_NODE);\n  let child = node.firstChild;\n  let offset = 0;\n  yield {node: node, offset: offset, text: stringifyElementStart(node, isLineStart)};\n  while (child != null) {\n    if (child.nodeType === Node.TEXT_NODE) {\n      yield {node: child, offset: 0/0, text: child.data};\n      isLineStart = false;\n    } else {\n      isLineStart = yield* positions(child, isLineStart);\n    }\n    child = child.nextSibling;\n    offset += 1;\n    yield {node: node, offset: offset, text: ''};\n  }\n  return isLineStart;\n}\n\nexport function getCaretPosition(contenteditable: any, textPosition: any): any {\n  let textOffset = 0;\n  let lastNode = null;\n  let lastOffset = 0;\n  for (let p of positions(contenteditable)) {\n    if (p.text.length > textPosition - textOffset) {\n      return {node: p.node, offset: p.node.nodeType === Node.TEXT_NODE ? textPosition - textOffset : p.offset};\n    }\n    textOffset += p.text.length;\n    lastNode = p.node;\n    lastOffset = p.node.nodeType === Node.TEXT_NODE ? p.text.length : p.offset;\n  }\n  return {node: lastNode, offset: lastOffset};\n}\n\nexport function getTextOffset(contenteditable: any, selectionNode: any, selectionOffset: any): any {\n  let textOffset = 0;\n  for (let p of positions(contenteditable)) {\n    if (selectionNode.nodeType !== Node.TEXT_NODE && selectionNode === p.node && selectionOffset === p.offset) {\n      return textOffset;\n    }\n    if (selectionNode.nodeType === Node.TEXT_NODE && selectionNode === p.node) {\n      return textOffset + selectionOffset;\n    }\n    textOffset += p.text.length;\n  }\n  return compareCaretPositons(selectionNode, selectionOffset, contenteditable, 0) < 0 ? 0 : textOffset;\n}\n\nexport function getValue(contenteditable: any): any{\n  let value = '';\n  for (let p of positions(contenteditable)) {\n    value += p.text;\n  }\n  return value;\n}\n\nexport function setSelectionRange(contenteditable: any, start: any, end: any): any {\n  let selection:any = window.getSelection();\n  let s = getCaretPosition(contenteditable, start);\n  let e = getCaretPosition(contenteditable, end);\n  selection.setBaseAndExtent(s.node, s.offset, e.node, e.offset);\n}\n\n//TODO: Ctrl+A - rangeCount is 2\nexport function getSelectionDirection(contenteditable: any): any {\n  let selection:any = window.getSelection();\n  let c = compareCaretPositons(selection.anchorNode, selection.anchorOffset, selection.focusNode, selection.focusOffset);\n  return c < 0 ? 'forward' : 'none';\n}\n\nexport function getSelectionStart(contenteditable: any): any {\n  let selection: any = window.getSelection();\n  let c = compareCaretPositons(selection.anchorNode, selection.anchorOffset, selection.focusNode, selection.focusOffset);\n  return c < 0 ? getTextOffset(contenteditable, selection.anchorNode, selection.anchorOffset) : getTextOffset(contenteditable, selection.focusNode, selection.focusOffset);\n}\n\nexport function getSelectionEnd(contenteditable: any): any {\n  let selection: any = window.getSelection();\n  let c = compareCaretPositons(selection.anchorNode, selection.anchorOffset, selection.focusNode, selection.focusOffset);\n  return c < 0 ? getTextOffset(contenteditable, selection.focusNode, selection.focusOffset) : getTextOffset(contenteditable, selection.anchorNode, selection.anchorOffset);\n}","import React, { useMemo } from 'react';\nimport { placeholder } from '@babel/types';\n\ninterface ContentEditableEle {\n  className: string;\n  onKeyPress?: any;\n  onKeyUp?: any;\n  onMouseUp?: any;\n  onMouseDown?: any;\n  onMouseMove?: any;\n  onFocus?:any;\n  onBlur?:any;\n  placeholder?: string;\n  dangerouslySetInnerHTML?: {\n    __html: any\n  }\n  contents?: string;\n}\n\nconst ContentEditableEle = React.forwardRef<HTMLDivElement, ContentEditableEle>(({\n  className,\n  onKeyPress, \n  onKeyUp,\n  onMouseUp,\n  onMouseDown,\n  onMouseMove,\n  onFocus,\n  onBlur,\n  dangerouslySetInnerHTML,\n  contents,\n  placeholder\n}, ref) => {\n  \n  return (\n    <div \n      className={`bk-contentEditable ${className? className : \"\"}`}\n      ref={ref}\n      onKeyUp={onKeyUp}\n      onKeyPress={onKeyPress}\n      onMouseUp={onMouseUp}\n      onMouseDown={onMouseDown}\n      onMouseMove={onMouseMove}\n      onFocus={onFocus}\n      onBlur={onBlur}\n      contentEditable={true}\n      dangerouslySetInnerHTML={dangerouslySetInnerHTML}\n      placeholder={placeholder} \n    >\n      { contents }\n    </div>\n  )\n})\n\nexport default ContentEditableEle;","import React from 'react';\n\ninterface ColorStyleToggleButtonProps {\n  colorCode: number[];\n  onStyleChange: any;\n  addDelToggle: any;\n}\n\n\nfunction ColorStyleToggleButton({\n  colorCode,\n  onStyleChange,\n  addDelToggle\n}: ColorStyleToggleButtonProps) {\n  const RGBA = `rgba(${colorCode[0]}, ${colorCode[1]}, ${colorCode[2]}, ${colorCode[3]})`\n\n  const btnStyle = {\n    color: RGBA\n  }\n\n  const addDel = addDelToggle([\"fc\", RGBA])? \"del\" : \"color\";\n\n  console.log(btnStyle);\n\n  const handleClick = ()=> {\n    onStyleChange([\"fc\",RGBA], addDel);\n  }\n\n  return (\n    <button style={btnStyle} onClick={handleClick}>\n      Text\n      { addDel === \"del\"? \"v\" : null}\n    </button>\n  )\n}\n\nconst colorCodes:number[][] = [\n  [191, 63, 63, 1],\n  [191, 127, 63, 1],\n  [191, 191, 63, 1],\n  [127, 191, 63, 1],\n  [63, 191, 63, 1],\n  [63, 191, 127, 1],\n  [63, 127, 191, 1],\n  [63, 63, 191, 1],\n  [127, 63, 191, 1],\n  [191, 63, 191, 1],\n  [191, 63, 127, 1]\n];\n\ninterface ColorStyleToggleProps {\n  addDelToggle: any;\n  onStyleChange: any;\n}\n\nfunction ColorStyleToggle(\n  { addDelToggle, onStyleChange }: ColorStyleToggleProps\n  ) {\n\n  return (\n    <div className=\"bk-color-menu\">\n      {\n        colorCodes.map((code, key) => \n          <ColorStyleToggleButton \n            key={key}\n            colorCode={code}\n            onStyleChange={onStyleChange}\n            addDelToggle={addDelToggle}\n          />\n        )\n      }\n    </div>\n  )\n}\n\nexport default ColorStyleToggle;","import React, { useMemo, useEffect } from 'react';\nimport useBKlog from '../../../hooks/useBKlog';\nimport { \n  BlockData, \n  ContentType\n} from '../../../types/bklog';\nimport { \n  findTextStyle,\n  arrayFindIndex\n} from '../utils';\n\nimport ColorStyleToggle  from './ColorStyleToggle';\n\nconst textBlockType = [\n  \"h1\",\n  \"h2\",\n  \"h3\",\n  \"h4\",\n  \"p\"\n];\n\nfunction TextBlockTypeSelection() {\n  return (\n    <select>\n      { textBlockType.map((type => <option>{ type }</option>)) }\n    </select>\n  )\n}\n\ninterface TextStyleToggleButtonProps {\n  onStyleChange: any;\n  addDelToggle: boolean;\n  styleType: string;\n}\n\nfunction TextStyleToggleButton({\n  onStyleChange,\n  addDelToggle,\n  styleType\n}: TextStyleToggleButtonProps) {\n\n  const addDelClassName = addDelToggle? \"del\" : \"add\";\n\n  const handleClick = () => {\n    onStyleChange([styleType], addDelClassName)\n  }\n\n  return (\n    <button \n      className={`bk-textStyleToggle ${addDelClassName}`}\n      onClick={handleClick}\n    >\n      { styleType }\n    </button>\n  )\n}\n\ninterface TextStyleTogglesProps {\n  blockIndex: number;\n  startPosition: number;\n  endPosition: number;\n  contents: any;\n  reBlockFocus: any;\n}\n\nfunction TextStyleToggles({\n  blockIndex, \n  startPosition,\n  endPosition,\n  contents,\n  reBlockFocus\n}: TextStyleTogglesProps) {\n  const { onChangeTextStyle, onCommitBlock } = useBKlog();\n\n  const toggleProps:string[] = [\"b\", \"i\", \"_\"];\n\n  const onStyleChange = (styleType: ContentType, toggle: any) => {\n    onCommitBlock();\n    onChangeTextStyle(\n      blockIndex, \n      styleType,\n      startPosition, \n      endPosition,\n      toggle\n    )\n    reBlockFocus();\n  }\n\n  const testUnder = () => {\n    onChangeTextStyle(\n      blockIndex, \n      [\"fc\", \"rgba(0, 244, 255, 1)\"],\n      startPosition, \n      endPosition,\n      \"del\"\n    );\n    reBlockFocus();\n  }\n\n  const includedStyle = findTextStyle(contents, startPosition);\n\n  const addDelToggle = (prop:any):boolean => {\n    return arrayFindIndex(\n      includedStyle? \n      includedStyle : [], \n      prop\n      ) !== -1? true : false;\n  }\n\n  return (\n    <div \n      className=\"bk-style-toggles\"\n    >\n      <TextBlockTypeSelection \n      />\n      {\n        toggleProps.map((prop, idx)=> \n          <TextStyleToggleButton \n            key={idx}\n            onStyleChange={onStyleChange}\n            styleType={prop}\n            addDelToggle={addDelToggle([prop])}\n          />\n        )\n      }\n      <ColorStyleToggle\n        addDelToggle={addDelToggle}\n        onStyleChange={onStyleChange}\n      />\n    </div>\n  )\n}\n\nexport default TextStyleToggles;","import React, { useEffect, useRef, useState, useMemo, useCallback } from 'react';\n\nimport useBKlog from '../../../hooks/useBKlog';\nimport { \n  BlockData\n} from '../../../types/bklog';\nimport { \n  contentsElement,\n  createContentsElement\n} from '../utils';\nimport { \n  getSelectionStart,\n  getSelectionEnd,\n  setSelectionRange\n} from '../utils/selectionText';\n\nimport ContentEditableEle from './ContentEditableEle';\nimport TextStyleToggle from './TextStyleToggle';\n\nimport './block.scss';\n\ninterface BlockProps {\n  blockData: BlockData<any>;\n}\n\nfunction Block({ blockData }:BlockProps) {\n\n  const [ editing, setEditing ] = useState<boolean>(true);\n  const [ cursorStart, setCursorStart ] = useState<number>(0);\n  const [ cursorEnd, setCursorEnd ] = useState<number>(0);\n\n  const [ styleToggle, setStyleToggle ] = useState<boolean>(false);\n\n  const blockRef = useRef<HTMLDivElement>(null);\n\n  const { \n    getRigthToEdit,\n    getEditAbleId,\n    onAddBlock, \n    onDeleteBlock,\n    getChilrenBlock,\n    onEditAble,\n    onEditBlock,\n    onCommitBlock\n  } = useBKlog();\n\n  const createMarkup = useMemo(()=> {\n    const htmlElement = blockData.property && blockData.property.contents[0]?\n    (blockData.property.contents.length === 1? \n      contentsElement(blockData.property.contents[0])\n      : blockData.property.contents.reduce(createContentsElement)\n    ) : \"\";\n\n    return {\n      __html: htmlElement\n    }\n  }, [blockData.property]);\n  \n  // 위치 변경시 어떻게 리프레쉬 될지 고민해야 함.\n  const childrenBlock = blockData.children[0]? \n    getChilrenBlock(blockData.id) : null;\n\n\n  // keyboard methods\n  const handleKeyUp = (e:any) => {  \n    setCursorStart(getSelectionStart(e.target));\n    setCursorEnd(getSelectionEnd(e.target));\n\n    switch(e.key) {\n \n      case \"Enter\":\n        setCursorStart(0);\n        setCursorEnd(0);\n        e.preventDefault();\n        break;\n\n      case \"ArrowUp\": \n      // cursor가 앞으로 튐\n        \n        if(cursorStart === 0) {\n          e.preventDefault();\n          setCursorStart(0);\n          setCursorEnd(0);\n          onEditAble(null, blockData.index - 1);\n        }\n        \n        break;\n\n      case \"ArrowDown\":\n\n        if(cursorEnd === e.target.innerText.length) {\n          setCursorStart(0);\n          setCursorEnd(0);\n          e.preventDefault();\n          onEditAble(null, blockData.index + 1);\n        }\n        \n        break;\n\n      case \"Backspace\":\n        if(!e.target.innerHTML && cursorStart === 0 && cursorEnd === 0) {\n          onDeleteBlock(blockData.id);\n          if(blockData.index > 1) onEditAble(null, blockData.index-1);\n          break;\n        } else {\n          onEditBlock(blockData.id, blockData.index, e.target.innerHTML);\n          break;\n        }\n      \n      case \" \":\n        setCursorEnd(0);\n        onEditBlock(blockData.id, blockData.index, e.target.innerHTML);\n        onCommitBlock();\n        break;\n      \n      default:\n        onEditBlock(blockData.id, blockData.index, e.target.innerHTML);\n\n    }\n\n  }\n\n  // const moveStartPoint = (ele: any) => {\n  //   setCursorStart(0);\n  //   setCursorEnd(0);\n  //   setSelectionRange(ele, 0, 0);\n  // }\n\n  const moveEndPoint = (ele: any) => {\n    const length = ele.innerText.length;\n    setCursorStart(length);\n    setCursorEnd(length);\n    setSelectionRange(ele, length, length);\n  }\n\n  const refreshPoint = (\n    ele:any, \n    cursorStart: number, \n    cursorEnd?: number | null\n    ) => {\n    setSelectionRange(ele, cursorStart, cursorEnd? cursorEnd : cursorStart);\n  }\n\n  const handleKeyPress = (e:any) => {\n    if(e.key === \"Enter\") {\n      e.preventDefault();\n      onAddBlock(blockData.id, blockData.property? blockData.property.type : null);\n    }\n  }\n\n  // mouse methods\n  const handleMouseUp = (e: any) => {\n    const getStartPosition = getSelectionStart(blockRef.current);\n    const getEndPosition = getSelectionEnd(blockRef.current);\n    setCursorStart(getStartPosition);\n    setCursorEnd(getEndPosition);\n  }\n\n  // Focus methods\n  const handleBlur = (e:any) => {\n    if (e.currentTarget === e.target) {\n      // console.log('unfocused self 1');\n    } else {\n      // console.log('unfocused child 2', e.target);\n    }\n    if (!e.currentTarget.contains(e.relatedTarget)) {\n      // Not triggered when swapping focus between children\n      setCursorStart(0);\n      setCursorEnd(0);\n      onCommitBlock();\n    }\n  }\n\n  const handleFocus = (ele: any) => {\n    ele.focus();\n  }\n\n  const isFocus = (e: any) => {\n    if(!styleToggle) {\n      moveEndPoint(blockRef.current);\n    } else if((cursorStart | cursorEnd)) {\n      refreshPoint(blockRef.current, cursorStart, cursorEnd);\n    } \n    onEditAble(blockData.id);\n  }\n\n  useEffect(()=> {\n    const focused = document.activeElement;\n    \n    if((cursorStart | cursorEnd) && focused === blockRef.current) {\n      refreshPoint(blockRef.current, cursorStart, cursorEnd);\n    }\n\n  }, [blockData.property])\n\n  useEffect(()=> {\n    if(getEditAbleId === blockData.id) {\n      if(blockRef.current) handleFocus(blockRef.current);\n    }\n  },[getEditAbleId]);\n\n  useEffect(()=> {\n    if(blockData.type === \"container\") {\n      if(!blockData.children[0]) onDeleteBlock(blockData.id);\n    }\n  }, [blockData.children])\n\n  useEffect(()=> {\n    if(cursorEnd - cursorStart >= 1) {\n      setStyleToggle(true);\n    } else {\n      setStyleToggle(false);\n    }\n  }, [cursorStart, cursorEnd]);\n\n  const reBlockFocus = ()=> {\n    handleFocus(blockRef.current);\n  }\n\n  return (\n    <div \n      data-index={blockData.index} \n      className=\"block-zone\"\n    >\n       <div \n        className=\"block black-mode\"\n        onBlur={handleBlur}\n       > \n        { \n          blockData.property && blockData.type !== \"container\" ? \n            <ContentEditableEle \n              className={blockData.property.type}\n              dangerouslySetInnerHTML={createMarkup}\n              ref={blockRef}\n              onKeyPress={handleKeyPress}\n              onKeyUp={handleKeyUp}\n              onMouseUp={handleMouseUp}\n              onFocus={isFocus}\n              placeholder=\"입력해주세요...\"\n            />\n          : null\n        }\n        <button className=\"bk-del\" onClick={()=>{onDeleteBlock(blockData.id)}}> 삭제 </button>\n        {\n          styleToggle? \n          <TextStyleToggle\n            blockIndex={blockData.index}\n            startPosition={cursorStart}\n            endPosition={cursorEnd}\n            contents={blockData.property.contents}\n            reBlockFocus={reBlockFocus}\n          /> : null\n        }\n      </div>\n          {\n            childrenBlock ? \n            childrenBlock.map((child)=> \n              <Block \n                blockData={child}\n                key={child.id}\n              />\n            ) : null\n          }\n    </div>\n  )\n}\n\nexport default Block;","import Block from './Block';\n\nexport default Block;","import { \n  insertBlock,\n  copyBlockDataList,\n  excludeBlockList\n} from './store/modules/bklog/utils';\nimport { page } from './data/db.json';\nimport orderingBlock from './store/modules/bklog/utils/ordering';\n\nconst TEST_BLOCKS = page.blocks;\n\nconst TEST_BLOCKDATALIST = [\n  {\n    id: \"c7ce6d39-bf2a-4712-9318-d2313a917a62\",\n    type: \"container\",\n    parentBlockId: null,\n    preBlockId: \"d5cc2725-97ec-494b-bc80-c16f96379e11\",\n    nextBlockId: \"s5cc2725-97ec-494b-bc80-c16f96379e61\",\n    property: null,\n    children: [\n      \"a85758ba-bbb5-45e1-aaa0-e3395e0dfd78\",\n      \"3723c55f-66f0-4ad0-b796-0dbcd8d82ce8\",\n      \"2453d55f-66f0-4ad0-b796-0dbcd8d82ce8\"\n    ]\n  },\n  {\n    id: \"a85758ba-bbb5-45e1-aaa0-e3395e0dfd78\",\n    type: \"block\",\n    parentBlockId: \"c7ce6d39-bf2a-4712-9318-d2313a917a62\",\n    preBlockId: null,\n    nextBlockId: \"3723c55f-66f0-4ad0-b796-0dbcd8d82ce8\",\n    property: {\n      \"type\": \"bk-h1\",\n      \"styles\": {\n        \"color\": \"black\",\n        \"backgroudColor\": \"white\"\n      },\n      \"contents\": [\n        [\"블록 \"],\n        [\"1 입\", [[\"b\"], [\"fc\", \"#fc0\"]]],\n        [\"니다.\"]\n      ]\n    },\n    children: []\n  },\n  {\n    id: \"3723c55f-66f0-4ad0-b796-0dbcd8d82ce8\",\n    type: \"block\",\n    parentBlockId: \"c7ce6d39-bf2a-4712-9318-d2313a917a62\",\n    preBlockId: \"a85758ba-bbb5-45e1-aaa0-e3395e0dfd78\",\n    nextBlockId: \"2453d55f-66f0-4ad0-b796-0dbcd8d82ce8\",\n    property: {\n      \"type\": \"bk-h1\",\n      \"styles\": {\n        \"color\": \"black\",\n        \"backgroudColor\": \"white\"\n      },\n      \"contents\": [\n        [\"블록 \"],\n        [\"2 입\", [[\"i\"]]],\n        [\"니다.\"]\n      ]\n    },\n    children: [\n      \"4453c55f-66f0-4ad0-b796-0dbcd8d82ce8\"\n    ]\n  },\n  {\n    id: \"4453c55f-66f0-4ad0-b796-0dbcd8d82ce8\",\n    type: \"block\",\n    parentBlockId: \"3723c55f-66f0-4ad0-b796-0dbcd8d82ce8\",\n    preBlockId: null,\n    nextBlockId: null,\n    property: {\n      \"type\": \"bk-h1\",\n      \"styles\": {\n        \"color\": \"black\",\n        \"backgroudColor\": \"white\"\n      },\n      \"contents\": [\n        [\"블록 \"],\n        [\"3 입\", [[\"b\"]]],\n        [\"니다.\"]\n      ]\n    },\n    children: [\n    ]\n  },\n  {\n    id: \"2453d55f-66f0-4ad0-b796-0dbcd8d82ce8\",\n    type: \"block\",\n    parentBlockId: \"c7ce6d39-bf2a-4712-9318-d2313a917a62\",\n    preBlockId: \"3723c55f-66f0-4ad0-b796-0dbcd8d82ce8\",\n    nextBlockId: null,\n    property: {\n      \"type\": \"bk-h1\",\n      \"styles\": {\n        \"color\": \"black\",\n        \"backgroudColor\": \"white\"\n      },\n      \"contents\": [\n        [\"블록 \"],\n        [\"4 입\", [[\"b\"]]],\n        [\"니다.\"]\n      ]\n    },\n    children: [\n    ]\n  }\n]\n\nconst TEST_PRE_ID = \"2453d55f-66f0-4ad0-b796-0dbcd8d82ce8\";\n\nfunction testCopyBlockList() {\n  const newDataList = copyBlockDataList(TEST_BLOCKDATALIST);\n  const aaa = copyBlockDataList(TEST_BLOCKDATALIST);\n  const testDataList = orderingBlock(TEST_BLOCKS);\n  const testDataIdList = newDataList.map(block => block.id);\n  \n  const insertedBlock = orderingBlock(insertBlock(testDataList, newDataList, TEST_PRE_ID));\n  const newInsertedBlock = [...insertedBlock];\n\n  console.log(aaa, testDataList, testDataIdList, insertedBlock);\n  const deletedBlock = orderingBlock(excludeBlockList(newInsertedBlock, testDataIdList));\n  \n  return deletedBlock;\n}\n\nexport const newDataList = copyBlockDataList(TEST_BLOCKDATALIST);\n\nexport const TEST_CASE_01 = testCopyBlockList();","import React, { useEffect, useState } from 'react';\nimport { useIdleTimer } from 'react-idle-timer';\nimport useBKlog from '../hooks/useBKlog';\nimport Block from '../components/bklog/block';\n\nimport { BlockData } from '../types/bklog';\n\nimport { TEST_CASE_01, newDataList } from '../index.test';\n\nfunction BklogContainer() { \n  \n  const [count, setCount] = useState(1);\n  \n  const { \n    state, \n    initBlock, \n    onAddBlock, \n    onCommitBlock, \n    onChangeTextStyle,\n    onSwitchBlock,\n    onRevertBlock\n  } = useBKlog();\n\n  const click = () => {\n    onAddBlock(undefined, undefined, {\n      index: 0,\n      id: \"d5cc2725-97ec-494b-bc80-c16f96379e61\",\n      type: \"block\",\n      parentBlockId: null,\n      preBlockId: null,\n      nextBlockId: null,\n      property: {\n        type:  \"BKlog-h1\",\n        styles: {\n          color: null,\n          backgroundColor: null\n        },\n        contents: [\n          [\"블록 1입니다.\"],\n          [\"저\", [[\"b\"], [\"fc\", \"#c0f\"], [\"bc\", \"#000\"], [\"i\"],[\"a\", \"https://www.naver.com\"]]],\n          [\"는 \", [[\"i\"]]],\n          [\"황준희\", [[\"b\"]]],\n          [\" 입니다.\", [[\"fc\", \"#f00\"]]]\n        ]\n      },\n      children: [\n        \"2453d55f-66f0-4ad0-b796-0dbcd8d82ce8\"\n      ]\n    });\n  }\n\n  const handleOnIdle = () => {\n    console.log('last active', getLastActiveTime());\n    if(state.stage[0]) {\n      console.log('commit');\n      onCommitBlock();\n    }\n  }\n  const handleClick = () => {\n    onChangeTextStyle (1, [\"bc\", \"#fc0\"], 2, 10, \"color\");\n  }\n\n  const testHandleClick = () => {\n    onSwitchBlock(state.blocks[2].id, state.blocks[6 + count].id);\n    setCount(count+1);\n  }\n\n  const revertHandleClick = () => {\n    onRevertBlock();\n  }\n  // const handleOnActive = (event: any) => {\n  //   console.log('user is active', event)\n  //   console.log('time remaining', getRemainingTime())\n  // }\n\n  // const handleOnAction = (e: any) => {\n  //   console.log('user did something', e)\n  // }\n\n  const { getLastActiveTime } = useIdleTimer({\n    timeout: 10 * 60 * 5,\n    onIdle: handleOnIdle,\n    debounce: 500\n  })\n\n  const blockData:any = initBlock[0]? initBlock : null;\n\n  useEffect(() => {\n    console.log(\"case: blockList 붙혀넣기\", TEST_CASE_01);\n    console.log(\"adsd\");\n  }, []);\n\n  return (\n    <div className=\"blocklog notranslate\">\n      {\n        blockData?\n        blockData.map((block: BlockData<any>)=> \n          <Block \n            blockData={block}\n            key={block.id}\n          />\n        ) : <div>\"\"</div>\n      }\n      {\n        blockData.length <= 1? \n        <div className=\"bk-zone\"> \n          <div \n            className=\"bk-block\" \n            placeholder=\"입력해주세요...\"\n            onFocus={()=>onAddBlock()}\n            onClick={()=>onAddBlock()}\n            contentEditable=\"true\"\n          ></div>\n        </div> : null\n      }\n      <button onClick={click}>블럭 추가</button>\n      <button onClick={handleClick}>스타일 추가</button>\n      <button onClick={testHandleClick}>스위칭</button>\n      <button onClick={revertHandleClick}>되돌리기</button>\n    </div>\n  )\n}\n\nexport default BklogContainer;","import React, { useState } from 'react';\nimport { RouteComponentProps } from 'react-router';\nimport classNames from 'classnames';\n\nimport BklogContainer from '../containers/BklogContainer';\n\ninterface MatchParams {\n  id: string;\n}\n\nfunction BkPage({ match }: RouteComponentProps<MatchParams>) {\n\n  const [ mode, setMode ] = useState<boolean>(true);\n\n  console.log(match.params.id, match);\n\n  return (\n    <div className={classNames(\"bk-page\", {\"white-mode\": mode})}>\n      <BklogContainer />\n    </div>\n  );\n}\n\nexport default BkPage;","import React from 'react';\nimport { Route, Redirect, RouteComponentProps } from 'react-router-dom';\n\ninterface MatchParams {\n  id?: string;\n}\n\nexport default function AuthPage({ match }: RouteComponentProps<MatchParams>) {\n\n  if(match.params.id) {\n    console.log(match.params.id);\n    return <Redirect to=\"/\" />\n  }\n\n  return (\n    <div>\n      asdasd\n    </div>\n  )\n}","import React from 'react';\nimport { BrowserRouter as Router, Switch, Route, HashRouter} from 'react-router-dom';\nimport Home from './pages/Home';\nimport Editor from './components/editor/index';\nimport BkPage from './pages/BkPage';\nimport AuthPage from './pages/AuthPage';\n\nimport './App.scss';\n\n// hashRouter?\nfunction App() {\n  return (\n    <div className=\"App black-mode\">\n      <HashRouter basename=\"/bk\">\n        <Switch>\n          <Route path='/' component={Home} exact />\n          <Route path='/edit' component={Editor} />\n          <Route path='/bklog/:id' component={BkPage} />\n          <Route path='/auth/:id' component={AuthPage} />\n        </Switch>\n      </HashRouter>\n    </div>\n  );\n}\n\nexport default App;\n","import {\n  createAction,\n  ActionType,\n  createReducer\n} from 'typesafe-actions';\n\nconst INCREASE = 'counter/INCREASE' as const;\nconst DECREASE = 'counter/DECREASE' as const;\nconst INCREASE_BY = 'counter/INCREASE_BY' as const;\n\n// export const increase = () => ({\n//   type: INCREASE\n// });\n\n// export const decrease = () => ({\n//   type: DECREASE\n// });\n\n// export const increaseBy = (diff: number) => ({\n//   type: INCREASE_BY,\n//   payload: diff\n// });\n\n// type CounterAction = \n//   | ReturnType<typeof increase> \n//   | ReturnType<typeof decrease> \n//   | ReturnType<typeof increaseBy>;\n\nexport const increase = createAction(INCREASE)();\nexport const decrease = createAction(DECREASE)();\nexport const increaseBy = createAction(INCREASE_BY)<number>();\n\nconst actions = { increase, decrease, increaseBy };\ntype CounterAction = ActionType<typeof actions>;\n\ntype CounterState = {\n  count: number;\n};\n\nconst initialState: CounterState = {\n  count: 0\n};\n\n// function counter(\n//   state: CounterState = initialState,\n//   action: CounterAction\n// ): CounterState {\n\n//   switch (action.type) {\n\n//     case INCREASE: \n//       return { count: state.count + 1};\n\n//     case DECREASE: \n//       return { count: state.count - 1};\n\n//     case INCREASE_BY:\n//       return { count: state.count + action.payload };\n\n//     default: \n//       return state;\n\n//   }\n// }\n\nconst counter = createReducer<CounterState, CounterAction>(initialState, {\n  [INCREASE]: state => ({ count: state.count + 1 }),\n  [DECREASE]: state => ({ count: state.count - 1 }),\n  [INCREASE_BY]: (state, action) => ({ count: state.count + action.payload })\n});\n\nexport default counter;","const ADD_TODO = 'todos/ADD_TODO' as const;\nconst TOGGLE_TODO = 'todos/TOGGLE_TODO' as const;\nconst REMOVE_TODO = 'todos/REMOVE_TODO' as const;\n\nlet nextId = 1;\n\nexport const addTodo = (text: string) => ({\n  type: ADD_TODO,\n  payload: {\n    id: nextId++,\n    text\n  }\n});\n\nexport const toggleTodo = (id: number) => ({\n  type: TOGGLE_TODO,\n  payload: id\n});\n\nexport const removeTodo = (id: number) => ({\n  type: REMOVE_TODO,\n  payload: id\n});\n\ntype TodosAction = \n  | ReturnType<typeof addTodo>\n  | ReturnType<typeof toggleTodo>\n  | ReturnType<typeof removeTodo>;\n\nexport type Todo = {\n  id: number;\n  text: string;\n  done: boolean;\n}\n\nexport type TodosState = Todo[];\n\nconst initialState: TodosState = [];\n\nfunction todos(\n  state: TodosState = initialState,\n  action: TodosAction\n): TodosState {\n  switch (action.type) {\n    case ADD_TODO:\n      return state.concat({\n        id: action.payload.id,\n        text: action.payload.text,\n        done: false\n      });\n\n    case TOGGLE_TODO: \n      return state.map(todo => \n        todo.id === action.payload ? {...todo, done: !todo.done} : todo \n      );\n\n    case REMOVE_TODO: \n      return state.filter(todo => todo.id !== action.payload);\n\n    default: \n      return state;\n  }\n}\n\nexport default todos;","import { combineReducers } from 'redux';\nimport { all } from 'redux-saga/effects';\n\nimport counter  from './counter';\nimport todos    from './todos';\nimport blocklog from './blocklog';\nimport bklog    from './bklog';\nimport auth, { postsSaga } from './auth';\n\nconst rootReducer = combineReducers({\n  counter,\n  todos,\n  blocklog,\n  bklog,\n  auth\n});\nexport function* rootSage() {\n  yield all([postsSaga()]);\n}\n\nexport default rootReducer;\n\nexport type RootState = ReturnType<typeof rootReducer>;","import { createStore, applyMiddleware, compose } from 'redux';\nimport rootReducer, { rootSage } from './modules';\nimport createSagaMiddleware from 'redux-saga';\n\nconst sagaMiddleware = createSagaMiddleware();\n\n// const middleware = (store: any) => (next: any) => (action: any) => {\n//   console.log(action);\n//   const result = next(action);\n//   return result;\n// }\n\ndeclare global {\n  interface Window {\n    __REDUX_DEVTOOLS_EXTENSION_COMPOSE__?: typeof compose;\n  }\n}\n\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\n\nconst configureStore = (() => {\n  const store = createStore(rootReducer, composeEnhancers(\n    applyMiddleware(sagaMiddleware)\n  ));\n  sagaMiddleware.run(rootSage);\n\n  return store;\n})();\n\n// const store = createStore(rootReducer, applyMiddleware(\n//   composeEnhancers,\n//   sagaMiddleware\n// ));\n\n// sagaMiddleware.run(rootSage);\n\n// const configureStore = (() => {\n//   const store = createStore(rootReducer, applyMiddleware(\n//     sagaMiddleware\n//   ));\n\n//   return store;\n// })();\n\nexport default configureStore;","import React from 'react';\nimport App   from './App';\nimport { Provider } from 'react-redux';\nimport { CookiesProvider } from 'react-cookie';\nimport configureStore from './store';\n\nfunction Root() {\n  return (\n    <Provider store={configureStore}>\n      <CookiesProvider>\n        <App />\n      </CookiesProvider>\n    </Provider>\n  )\n}\n\nexport default Root;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Root from './Root';\nimport { Provider } from 'react-redux';\nimport configureStore from './store';\n\nimport './reset.css';\nimport './index.css';\n\nReactDOM.render(\n  <Root />,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}